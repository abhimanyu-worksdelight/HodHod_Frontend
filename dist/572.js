"use strict";(self.webpackChunkng2angle=self.webpackChunkng2angle||[]).push([[572],{7572:(Y,v,b)=>{b.r(v),b.d(v,{OrdersModule:()=>B});var T=b(6895),w=b(6691),x=b(5229),p=b(1071),t=b(4650),A=b(5867),O=b(8064);let R=(()=>{class o{constructor(s){this.afs=s,this.getChunkedArray=(a,l)=>{var e=0,r=a.length,c=[];for(e=0;e<r;e+=l){const i=a.slice(e,e+l);c.push(i)}return c}}getItemListByIds(s){return new Promise((a,l)=>{let e=[];const r=[...new Set(s)].filter(i=>""!=i),c=this.getChunkedArray(r,10);c.forEach((i,d)=>{this.afs.collection("products",n=>n.where(A.Z.firestore.FieldPath.documentId(),"in",i)).get().toPromise().then(n=>{n.forEach(h=>{let u={data:h.data(),id:h.id};e.push(u)}),c.length==d+1&&a(e)},n=>{l(n)})})})}getUserListByIds(s){return new Promise((a,l)=>{let e=[];const r=[...new Set(s)].filter(i=>""!=i),c=this.getChunkedArray(r,10);c.forEach((i,d)=>{this.afs.collection("users",n=>n.where(A.Z.firestore.FieldPath.documentId(),"in",i)).get().toPromise().then(n=>{n.forEach(h=>{let u={data:h.data(),id:h.id};e.push(u)}),c.length==d+1&&a(e)},n=>{l(n)})})})}getOnlyRedeemedOrders(){return this.afs.collection("orders",s=>s.where("redeem_status.is_redeemed","==",!0)).snapshotChanges()}getPendingOrders(){return this.afs.collection("orders",s=>s.where("redeem_status.is_redeemed","!=",!0)).snapshotChanges()}getOrdersListSuperAdmin(){return this.afs.collection("orders",s=>s).snapshotChanges()}}return o.\u0275fac=function(s){return new(s||o)(t.LFG(O.ST))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var I=b(4719);function S(o,f){1&o&&t._UZ(0,"div",7)}function C(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"select",28),t.NdJ("change",function(l){const r=t.CHM(s).row,c=t.oxw(3);return t.KtG(c.onChange(l.target.value,r))}),t.TgZ(1,"option",29),t._uU(2,"True"),t.qZA(),t.TgZ(3,"option",30),t._uU(4,"False"),t.qZA()()}if(2&o){const s=f.value;t.xp6(1),t.Q6J("selected",1==s),t.xp6(2),t.Q6J("selected",0==s)}}function Z(o,f){1&o&&(t.TgZ(0,"ngx-datatable-column",27),t.YNc(1,C,5,2,"ng-template",26),t.qZA())}function F(o,f){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&o){const s=f.value;t.xp6(1),t.Oqu(s||"--")}}function G(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"input",11),t.NdJ("keyup",function(l){t.CHM(s);const e=t.oxw();return t.KtG(e.updateFilter(l))}),t.qZA()(),t._UZ(4,"div",12),t.TgZ(5,"div",13)(6,"div",14)(7,"h4",15),t._uU(8,"Total Revenue : "),t.qZA(),t.TgZ(9,"h4",16),t._uU(10),t.qZA()()()(),t.TgZ(11,"ngx-datatable",17,18),t._UZ(13,"ngx-datatable-column",19)(14,"ngx-datatable-column",20)(15,"ngx-datatable-column",21)(16,"ngx-datatable-column",22)(17,"ngx-datatable-column",23),t.YNc(18,Z,2,0,"ngx-datatable-column",24),t.TgZ(19,"ngx-datatable-column",25),t.YNc(20,F,2,1,"ng-template",26),t.qZA()()()}if(2&o){const s=t.oxw();t.xp6(10),t.Oqu(s.totalRevenue),t.xp6(1),t.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",s.rowsFilter),t.xp6(2),t.Q6J("width",60),t.xp6(5),t.Q6J("ngIf",s.isVendor)}}function N(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"select",28),t.NdJ("change",function(l){const r=t.CHM(s).row,c=t.oxw(3);return t.KtG(c.onChange(l.target.value,r))}),t.TgZ(1,"option",29),t._uU(2,"True"),t.qZA(),t.TgZ(3,"option",30),t._uU(4,"False"),t.qZA()()}if(2&o){const s=f.value;t.xp6(1),t.Q6J("selected",1==s),t.xp6(2),t.Q6J("selected",0==s)}}function q(o,f){1&o&&(t.TgZ(0,"ngx-datatable-column",27),t.YNc(1,N,5,2,"ng-template",26),t.qZA())}function U(o,f){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&o){const s=f.value;t.xp6(1),t.Oqu(s||"--")}}function J(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"input",11),t.NdJ("keyup",function(l){t.CHM(s);const e=t.oxw();return t.KtG(e.updateFilter(l))}),t.qZA()(),t._UZ(4,"div",12),t.TgZ(5,"div",13)(6,"div",14)(7,"h4",15),t._uU(8,"Total Revenue : "),t.qZA(),t.TgZ(9,"h4",16),t._uU(10),t.qZA()()()(),t.TgZ(11,"ngx-datatable",17,18),t._UZ(13,"ngx-datatable-column",19)(14,"ngx-datatable-column",20)(15,"ngx-datatable-column",21)(16,"ngx-datatable-column",22)(17,"ngx-datatable-column",23),t.YNc(18,q,2,0,"ngx-datatable-column",24),t.TgZ(19,"ngx-datatable-column",25),t.YNc(20,U,2,1,"ng-template",26),t.qZA()()()}if(2&o){const s=t.oxw();t.xp6(10),t.Oqu(s.totalRevenue),t.xp6(1),t.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",s.rowsFilter),t.xp6(2),t.Q6J("width",60),t.xp6(5),t.Q6J("ngIf",s.isVendor)}}function k(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"select",28),t.NdJ("change",function(l){const r=t.CHM(s).row,c=t.oxw(3);return t.KtG(c.onChange(l.target.value,r))}),t.TgZ(1,"option",29),t._uU(2,"True"),t.qZA(),t.TgZ(3,"option",30),t._uU(4,"False"),t.qZA()()}if(2&o){const s=f.value;t.xp6(1),t.Q6J("selected",1==s),t.xp6(2),t.Q6J("selected",0==s)}}function Q(o,f){1&o&&(t.TgZ(0,"ngx-datatable-column",27),t.YNc(1,k,5,2,"ng-template",26),t.qZA())}function H(o,f){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&o){const s=f.value;t.xp6(1),t.Oqu(s||"--")}}function V(o,f){if(1&o){const s=t.EpF();t.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"input",11),t.NdJ("keyup",function(l){t.CHM(s);const e=t.oxw();return t.KtG(e.updateFilter(l))}),t.qZA()(),t._UZ(4,"div",12),t.TgZ(5,"div",13)(6,"div",14)(7,"h4",15),t._uU(8,"Total Revenue : "),t.qZA(),t.TgZ(9,"h4",16),t._uU(10),t.qZA()()()(),t.TgZ(11,"ngx-datatable",17,18),t._UZ(13,"ngx-datatable-column",19)(14,"ngx-datatable-column",20)(15,"ngx-datatable-column",21)(16,"ngx-datatable-column",22)(17,"ngx-datatable-column",23),t.YNc(18,Q,2,0,"ngx-datatable-column",24),t.TgZ(19,"ngx-datatable-column",25),t.YNc(20,H,2,1,"ng-template",26),t.qZA()()()}if(2&o){const s=t.oxw();t.xp6(10),t.Oqu(s.totalRevenue),t.xp6(1),t.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",s.rowsFilter),t.xp6(2),t.Q6J("width",60),t.xp6(5),t.Q6J("ngIf",s.isVendor)}}const D=function(o){return{active:o}};let L=(()=>{class o{constructor(s,a){this.ordersService=s,this.afs=a,this.Products=[],this.Orders=[],this.arrayRowData="",this.rowsFilter=[],this.arrayTableData=[],this.byOrdersAllIds=[],this.byGiftSenderAllIds=[],this.isLoading=!1,this.totalRevenue=0,this.isVendor=!1,this.positionItems=[0,1,2],this.allTabActive=1}ngOnInit(){this.loginType=sessionStorage.getItem("loginType"),this.uid=sessionStorage.getItem("uid"),this.getAllOrders()}getRedeemedOrders(){"u7GeGmO2luLmkOMKeZ0k"==this.loginType?(this.isVendor=!1,this.afs.collection("vendors",s=>s.where("uid","==",this.uid)).snapshotChanges().subscribe(s=>{this.rowsFilter=[],this.arrayTableData=[],s.length&&s.map(a=>{this.afs.collection("orders",l=>l).snapshotChanges().subscribe(l=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,l.length){this.Orders=[],this.Orders=l.map(e=>{let r=e.payload.doc.data();return{id:e.payload.doc.id,data:r}}),this.arrayTableData=[];for(let e=0;e<this.Orders.length;e++)null!=this.Orders[e].data&&null!=this.Orders[e].data.redeem_status&&1==this.Orders[e].data.redeem_status.is_redeemed&&(this.arrayRowData=this.Orders[e].data,this.arrayRowData.sr_no=e+1,this.arrayRowData.id=this.Orders[e].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1);if(this.arrayTableData){for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].product_id&&this.byOrdersAllIds.push(this.arrayTableData[e].product_id);console.log("byOrdersAllIds",this.byOrdersAllIds);for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[e].gift_sender);console.log("byGiftSenderAllIds AllRedeemed",this.byGiftSenderAllIds),this.byOrdersAllIds&&this.byOrdersAllIds.length?this.ordersService.getItemListByIds(this.byOrdersAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(_=>_.id==d.product_id),h=d;h.sr_no=i+1,h.item_name=n?n.data.itemInfo.name:"N/A",h.price=n?n.data.itemInfo.price:"N/A";let m,y,u=0,g=0;this.arrayTableData[i].commission&&(m=this.arrayTableData[i].commission.type,y=this.arrayTableData[i].commission.value,"SAR"==m?u=y:"%"==m?(u=n.data.itemInfo.price*this.arrayTableData[i].commission.value/100,g=n.data.itemInfo.price-u):g=0),this.arrayRowData.commission=y+" ("+m+")",this.arrayRowData.amount=g,this.totalRevenue=this.totalRevenue+g,console.log("revenue"+this.totalRevenue),this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1,this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(u=>u.id==d.gift_sender),h=d;h.sr_no=i+1,h.user_name=n?n.data.name:"N/A",this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1})})})):(this.isVendor="WxAsS1whStfbgdXvxqHs"==this.loginType,this.ordersService.getOnlyRedeemedOrders().subscribe(s=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,s.length){this.Orders=[],this.Orders=s.map(a=>{let l=a.payload.doc.data();return{id:a.payload.doc.id,data:l}}),this.arrayTableData=[];for(let a=0;a<this.Orders.length;a++)this.arrayRowData=this.Orders[a].data,this.arrayRowData.sr_no=a+1,this.arrayRowData.id=this.Orders[a].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1;if(this.arrayTableData){for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].product_id&&this.byOrdersAllIds.push(this.arrayTableData[a].product_id);for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[a].gift_sender);this.byOrdersAllIds&&this.byOrdersAllIds.length&&this.ordersService.getItemListByIds(this.byOrdersAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(y=>y.id==c.product_id),d=c;d.sr_no=r+1,d.item_name=i?i.data.itemInfo.name:"N/A",d.price=i?i.data.itemInfo.price:"N/A";let h,u,n=0,m=0;this.arrayTableData[r].commission&&(h=this.arrayTableData[r].commission.type,u=this.arrayTableData[r].commission.value,"SAR"==h?n=u:"%"==h?(n=i.data.itemInfo.price*this.arrayTableData[r].commission.value/100,m=n):m=0),this.arrayRowData.commission=u+" ("+h+")",this.arrayRowData.amount=m,this.totalRevenue=this.totalRevenue+m,this.arrayTableData.push(d),console.log("revenue"+this.totalRevenue)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}),this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(n=>n.id==c.gift_sender),d=c;d.sr_no=r+1,d.user_name=i?i.data.name:"N/A",this.arrayTableData.push(d)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1}))}getAllOrders(){"u7GeGmO2luLmkOMKeZ0k"==this.loginType?(this.isVendor=!1,this.afs.collection("vendors",s=>s.where("uid","==",this.uid)).snapshotChanges().subscribe(s=>{this.rowsFilter=[],this.arrayTableData=[],s.length&&s.map(a=>{this.afs.collection("orders",l=>l).snapshotChanges().subscribe(l=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,l.length){this.Orders=[],this.Orders=l.map(e=>{let r=e.payload.doc.data();return{id:e.payload.doc.id,data:r}}),this.arrayTableData=[];for(let e=0;e<this.Orders.length;e++)null!=this.Orders[e].data&&null!=this.Orders[e].data.redeem_status&&1==this.Orders[e].data.redeem_status.is_redeemed&&(this.arrayRowData=this.Orders[e].data,this.arrayRowData.sr_no=e+1,this.arrayRowData.id=this.Orders[e].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1);if(this.arrayTableData){for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].product_id&&this.byOrdersAllIds.push(this.arrayTableData[e].product_id);console.log("byOrdersAllIds",this.byOrdersAllIds);for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[e].gift_sender);console.log("byGiftSenderAllIds AllOrders",this.byGiftSenderAllIds),this.byOrdersAllIds&&this.byOrdersAllIds.length?this.ordersService.getItemListByIds(this.byOrdersAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(_=>_.id==d.product_id),h=d;h.sr_no=i+1,h.item_name=n?n.data.itemInfo.name:"N/A",h.price=n?n.data.itemInfo.price:"N/A";let m,y,u=0,g=0;this.arrayTableData[i].commission&&(m=this.arrayTableData[i].commission.type,y=this.arrayTableData[i].commission.value,"SAR"==m?u=y:"%"==m?(u=n.data.itemInfo.price*this.arrayTableData[i].commission.value/100,g=n.data.itemInfo.price-u):g=0),this.arrayRowData.commission=y+" ("+m+")",this.arrayRowData.amount=g,this.totalRevenue=this.totalRevenue+g,console.log("revenue"+this.totalRevenue),this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1,this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(u=>u.id==d.gift_sender),h=d;h.sr_no=i+1,h.user_name=n?n.data.name:"N/A",this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1})})})):(this.isVendor="WxAsS1whStfbgdXvxqHs"==this.loginType,this.ordersService.getOrdersListSuperAdmin().subscribe(s=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,s.length){this.Orders=[],this.Orders=s.map(a=>{let l=a.payload.doc.data();return{id:a.payload.doc.id,data:l}}),this.arrayTableData=[];for(let a=0;a<this.Orders.length;a++)this.arrayRowData=this.Orders[a].data,this.arrayRowData.sr_no=a+1,this.arrayRowData.id=this.Orders[a].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1;if(this.arrayTableData){for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].product_id&&this.byOrdersAllIds.push(this.arrayTableData[a].product_id);for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[a].gift_sender);this.byOrdersAllIds&&this.byOrdersAllIds.length&&this.ordersService.getItemListByIds(this.byOrdersAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(y=>y.id==c.product_id),d=c;d.sr_no=r+1,d.item_name=i?i.data.itemInfo.name:"N/A",d.price=i?i.data.itemInfo.price:"N/A";let h,u,n=0,m=0;this.arrayTableData[r].commission&&(h=this.arrayTableData[r].commission.type,u=this.arrayTableData[r].commission.value,"SAR"==h?n=u:"%"==h?(n=i.data.itemInfo.price*this.arrayTableData[r].commission.value/100,m=n):m=0),this.arrayRowData.commission=u+" ("+h+")",this.arrayRowData.amount=m,this.totalRevenue=this.totalRevenue+m,this.arrayTableData.push(d),console.log("revenue"+this.totalRevenue)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}),this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(n=>n.id==c.gift_sender),d=c;d.sr_no=r+1,d.user_name=i?i.data.name:"N/A",this.arrayTableData.push(d)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1}))}updateFilter(s){const a=s.target.value.toLowerCase(),l=this.arrayTableData.filter(function(e){if(""!=e.name&&null!=e.name)return-1!==e.name.toLowerCase().indexOf(a)||!a});this.rowsFilter=l,this.table.offset=0}onChange(s,a){this.afs.collection("orders").doc(a.qr_code).update({"redeem_status.is_redeemed":"true"==s}).then(()=>{console.log("done")}).catch(function(l){console.error("Error writing document: ",l)})}allTabClicked(){this.getAllOrders()}redeemTabClicked(){this.getRedeemedOrders()}pendingTabClicked(){this.getNotRedeemedOrders()}getNotRedeemedOrders(){"u7GeGmO2luLmkOMKeZ0k"==this.loginType?(console.log("u7GeGmO2luLmkOMKeZ0k.."),this.isVendor=!1,this.afs.collection("vendors",s=>s.where("uid","==",this.uid)).snapshotChanges().subscribe(s=>{this.rowsFilter=[],this.arrayTableData=[],s.length&&s.map(a=>{this.afs.collection("orders",l=>l).snapshotChanges().subscribe(l=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,l.length){this.Orders=[],this.Orders=l.map(e=>{let r=e.payload.doc.data();return{id:e.payload.doc.id,data:r}}),this.arrayTableData=[];for(let e=0;e<this.Orders.length;e++)null!=this.Orders[e].data&&null!=this.Orders[e].data.redeem_status&&1==this.Orders[e].data.redeem_status.is_redeemed&&(this.arrayRowData=this.Orders[e].data,this.arrayRowData.sr_no=e+1,this.arrayRowData.id=this.Orders[e].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1);if(this.arrayTableData){for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].product_id&&this.byOrdersAllIds.push(this.arrayTableData[e].product_id);console.log("byOrdersAllIds",this.byOrdersAllIds);for(let e=0;e<this.arrayTableData.length;e++)this.arrayTableData[e].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[e].gift_sender);console.log("byGiftSenderAllIds NotRedeemed",this.byGiftSenderAllIds),this.byOrdersAllIds&&this.byOrdersAllIds.length?this.ordersService.getItemListByIds(this.byOrdersAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(_=>_.id==d.product_id),h=d;h.sr_no=i+1,h.item_name=n?n.data.itemInfo.name:"N/A",h.price=n?n.data.itemInfo.price:"N/A";let m,y,u=0,g=0;this.arrayTableData[i].commission&&(m=this.arrayTableData[i].commission.type,y=this.arrayTableData[i].commission.value,"SAR"==m?u=y:"%"==m?(u=n.data.itemInfo.price*this.arrayTableData[i].commission.value/100,g=n.data.itemInfo.price-u):g=0),this.arrayRowData.commission=y+" ("+m+")",this.arrayRowData.amount=g,this.totalRevenue=this.totalRevenue+g,console.log("revenue"+this.totalRevenue),this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1,this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(e=>{const r=e,c=this.arrayTableData.length;for(let i=0;i<c;i++){let d=this.arrayTableData[i];const n=r.find(u=>u.id==d.gift_sender),h=d;h.sr_no=i+1,h.user_name=n?n.data.name:"N/A",this.arrayTableData.push(h)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1})})})):("WxAsS1whStfbgdXvxqHs"==this.loginType?(this.isVendor=!0,console.log("WxAsS1whStfbgdXvxqHs")):this.isVendor=!1,this.ordersService.getPendingOrders().subscribe(s=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayTableData=[],this.totalRevenue=0,s.length){this.Orders=[],this.Orders=s.map(a=>{let l=a.payload.doc.data();return{id:a.payload.doc.id,data:l}}),this.arrayTableData=[];for(let a=0;a<this.Orders.length;a++)this.arrayRowData=this.Orders[a].data,this.arrayRowData.sr_no=a+1,this.arrayRowData.id=this.Orders[a].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1;if(this.arrayTableData){for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].product_id&&this.byOrdersAllIds.push(this.arrayTableData[a].product_id);for(let a=0;a<this.arrayTableData.length;a++)this.arrayTableData[a].gift_sender&&this.byGiftSenderAllIds.push(this.arrayTableData[a].gift_sender);this.byOrdersAllIds&&this.byOrdersAllIds.length&&this.ordersService.getItemListByIds(this.byOrdersAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(y=>y.id==c.product_id),d=c;d.sr_no=r+1,d.item_name=i?i.data.itemInfo.name:"N/A",d.price=i?i.data.itemInfo.price:"N/A";let h,u,n=0,m=0;this.arrayTableData[r].commission&&(h=this.arrayTableData[r].commission.type,u=this.arrayTableData[r].commission.value,"SAR"==h?n=u:"%"==h?(n=i.data.itemInfo.price*this.arrayTableData[r].commission.value/100,m=n):m=0),this.arrayRowData.commission=u+" ("+h+")",this.arrayRowData.amount=m,this.totalRevenue=this.totalRevenue+m,this.arrayTableData.push(d),console.log("revenue"+this.totalRevenue)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}),this.byGiftSenderAllIds&&this.byGiftSenderAllIds.length?this.ordersService.getUserListByIds(this.byGiftSenderAllIds).then(a=>{const l=a,e=this.arrayTableData.length;for(let r=0;r<e;r++){let c=this.arrayTableData[r];const i=l.find(n=>n.id==c.gift_sender),d=c;d.sr_no=r+1,d.user_name=i?i.data.name:"N/A",this.arrayTableData.push(d)}this.rowsFilter=this.arrayTableData,this.rowsFilter=[...new Set(this.rowsFilter)]}):this.isLoading=!1}}else this.isLoading=!1}))}}return o.\u0275fac=function(s){return new(s||o)(t.Y36(R),t.Y36(O.ST))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order-list"]],viewQuery:function(s,a){if(1&s&&t.Gf(p.nE,7),2&s){let l;t.iGM(l=t.CRH())&&(a.table=l.first)}},decls:16,vars:13,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],[1,"b","custom-tab-header"],["href","javascript:void(0)",1,"custom-tab-item",3,"ngClass","click"],[1,"card","card-default"],["class","spinner-border loading","role","status",4,"ngIf"],["class","card-body",4,"ngIf"],["role","status",1,"spinner-border","loading"],[1,"card-body"],[1,"row","mb-3"],[1,"col-lg-3"],["type","text","placeholder","Type to filter the name column...",1,"form-control",3,"keyup"],[1,"col-lg-5"],[1,"col-lg-4"],[1,"d-flex","justify-content-end"],[1,"text-primary"],[1,"text-danger"],[1,"bootstrap","no-detail-row",3,"scrollbarH","columnMode","footerHeight","rowHeight","limit","rows"],["table",""],["name","Sr. No.","prop","sr_no",3,"width"],["name","Order Id","prop","id"],["name","Product name","prop","itemInfo.name"],["name","Buyer name","prop","user_name"],["name","Price (SAR)","prop","itemInfo.price"],["name","Is redeemed","prop","redeem_status.is_redeemed",4,"ngIf"],["name","Status","prop","type"],["ngx-datatable-cell-template",""],["name","Is redeemed","prop","redeem_status.is_redeemed"],["name","redeem","id","",2,"width","70px",3,"change"],["value","true",3,"selected"],["value","false",3,"selected"]],template:function(s,a){1&s&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span"),t._uU(3,"Payments"),t.qZA()()(),t.TgZ(4,"div",2)(5,"a",3),t.NdJ("click",function(){return a.allTabActive=1,a.allTabClicked()}),t._uU(6,"All"),t.qZA(),t.TgZ(7,"a",3),t.NdJ("click",function(){return a.allTabActive=2,a.redeemTabClicked()}),t._uU(8,"Redeemed"),t.qZA(),t.TgZ(9,"a",3),t.NdJ("click",function(){return a.allTabActive=3,a.pendingTabClicked()}),t._uU(10,"Pending(not redeemed)"),t.qZA()(),t.TgZ(11,"div",4),t.YNc(12,S,1,0,"div",5),t.YNc(13,G,21,9,"div",6),t.YNc(14,J,21,9,"div",6),t.YNc(15,V,21,9,"div",6),t.qZA()),2&s&&(t.xp6(5),t.Q6J("ngClass",t.VKq(7,D,1==a.allTabActive)),t.xp6(2),t.Q6J("ngClass",t.VKq(9,D,2==a.allTabActive)),t.xp6(2),t.Q6J("ngClass",t.VKq(11,D,3==a.allTabActive)),t.xp6(3),t.Q6J("ngIf",a.isLoading),t.xp6(1),t.Q6J("ngIf",1===a.allTabActive),t.xp6(1),t.Q6J("ngIf",3===a.allTabActive),t.xp6(1),t.Q6J("ngIf",2===a.allTabActive))},dependencies:[T.mk,T.O5,I.YN,I.Kr,p.nE,p.UC,p.vq]}),o})();const M=[{path:"",component:L},{path:"orders",component:L}];let B=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[T.ez,x.m,p.xD,w.Bz.forChild(M),w.Bz]}),o})()}}]);