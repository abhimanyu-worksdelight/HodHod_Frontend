"use strict";(self.webpackChunkng2angle=self.webpackChunkng2angle||[]).push([[169],{6532:(ye,T,c)=>{c.r(T),c.d(T,{VendorsModule:()=>he});var h=c(6895),_=c(6691),D=c(5229),v=c(1071),u=c(5867),A=(c(6776),c(5439)),e=c(4650),y=c(4924),b=c(8064);function S(o,a){1&o&&e._UZ(0,"div",21)}function I(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"button",23),e._UZ(2,"em",24),e.qZA(),e.TgZ(3,"button",25),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.deleteVendorsData(i.uid,i.id))}),e._UZ(4,"em",26),e.qZA()()}if(2&o){const t=a.value;e.xp6(1),e.MGl("routerLink","/vendors/edit/",t,"")}}function E(o,a){if(1&o&&e._UZ(0,"img",29),2&o){const t=e.oxw().value;e.s9C("src",t,e.LSH)}}function M(o,a){1&o&&e._UZ(0,"img",30)}function L(o,a){if(1&o&&(e.YNc(0,E,1,1,"img",27),e.YNc(1,M,1,0,"img",28)),2&o){const t=a.value;e.Q6J("ngIf",t),e.xp6(1),e.Q6J("ngIf",!t)}}function J(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.value;e.xp6(1),e.Oqu(t||"--")}}function Y(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.value;e.xp6(1),e.Oqu(t)}}function Q(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.value;e.xp6(1),e.Oqu(1==t?"Yes":"No")}}const Z=c(1373);let w=(()=>{class o{constructor(t,n){this.vendorsService=t,this.afs=n,this.Vendors=[],this.arrayRowData="",this.rowsFilter=[],this.arrayTableData=[],this.isLoading=!1}ngOnInit(){this.loginType=sessionStorage.getItem("loginType"),this.getVendorsListingData()}getVendorsListingData(){this.vendorsService.getVendorsList().subscribe(t=>{if(this.isLoading=!0,this.rowsFilter=[],this.arrayRowData=[],this.Vendors=[],this.arrayTableData=[],t.length){this.Vendors=t.map(n=>{let r=n.payload.doc.data();return{id:n.payload.doc.id,data:r}});for(let n=0;n<this.Vendors.length;n++)this.arrayRowData=this.Vendors[n].data,this.arrayRowData.sr_no=n+1,this.arrayRowData.id=this.Vendors[n].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1,this.arrayRowData.created_at&&(this.arrayRowData.created_at="string"==typeof this.arrayRowData.created_at?A(parseInt(this.arrayRowData.created_at)).format("DD-MM-YYYY LT"):A(this.arrayRowData.created_at.toDate()).format("DD-MM-YYYY LT"));this.rowsFilter=this.arrayTableData}else this.isLoading=!1})}updateFilter(t){const n=t.target.value.toLowerCase(),r=this.arrayTableData.filter(function(i){if(""!=i.name&&null!=i.name)return-1!==i.name.toLowerCase().indexOf(n)||!n});this.rowsFilter=r,this.table.offset=0}deleteVendorsData(t,n){const r={deleted_at:u.Z.firestore.FieldValue.serverTimestamp(),deleted_by:t,disabled:!1,deleted_by_user_type:this.loginType};this.sweetalertWarning(t,n,r,"singleProductData")}sweetalertWarning(t,n,r,i){Z({title:"Are you sure?",text:"Want to delete data!",icon:"warning",buttons:{cancel:{text:"Cancel",value:null,visible:!0,className:"",closeModal:!0},confirm:{text:"Yes, delete it!",value:!0,visible:!0,className:"bg-danger",closeModal:!1}}}).then(l=>{if(l)if("singleProductData"==i)u.Z.functions().httpsCallable("disableUser")(t).then(m=>{m&&this.vendorsService.softDeleteSingleProduct(n,r).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.vendors":u.Z.firestore.FieldValue.increment(-1)}).then(()=>{Z("Deleted!","Data deleted!","success"),this.getVendorsListingData()})})});else if("multipleProductData"==i){const d=u.Z.functions().httpsCallable("disableMultipleUser");r.forEach(m=>{d(m.uid).then(p=>{p&&this.vendorsService.softDeleteMultipleProduct(m).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.vendors":u.Z.firestore.FieldValue.increment(-1)}).then(()=>{Z("Deleted!","Data deleted!","success"),this.getVendorsListingData()})})})})}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(y.m),e.Y36(b.ST))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-vendors-list"]],viewQuery:function(t,n){if(1&t&&e.Gf(v.nE,7),2&t){let r;e.iGM(r=e.CRH())&&(n.table=r.first)}},decls:28,vars:10,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-plus","mr-1"],[1,"card","card-default"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card-body"],[1,"row","mb-3"],[1,"col-lg-3"],["type","text","placeholder","Type to filter the name column...",1,"form-control",3,"keyup"],[1,"bootstrap","no-detail-row",3,"scrollbarH","columnMode","footerHeight","rowHeight","limit","rows"],["table",""],["name","Sr. No.","prop","sr_no",3,"width"],["name","Actions","sortable","false","prop","id"],["ngx-datatable-cell-template",""],["name","Unique Id","prop","id",3,"width"],["name","Image","sortable","false","prop","image"],["name","Name","prop","name"],["name","Email","prop","email"],["name","Created at","prop","created_at"],["name","Active","sortable","false","prop","is_enabled"],["role","status",1,"spinner-border","loading"],[1,"d-flex"],["type","button",1,"mr-1","btn","btn-success","comn-action-btn","mb-1",3,"routerLink"],["_ngcontent-lgi-c20","",1,"fas","fa-edit"],["type","button",1,"mr-1","btn","btn-danger","comn-action-btn","mb-1",3,"click"],["_ngcontent-lgi-c20","",1,"fas","fa-trash-alt"],["class","listImage",3,"src",4,"ngIf"],["src","assets/img/profile.jpg","class","listImage",4,"ngIf"],[1,"listImage",3,"src"],["src","assets/img/profile.jpg",1,"listImage"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Vendors"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Add New "),e.qZA()()(),e.TgZ(7,"div",4),e.YNc(8,S,1,0,"div",5),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"input",9),e.NdJ("keyup",function(i){return n.updateFilter(i)}),e.qZA()()(),e.TgZ(13,"ngx-datatable",10,11),e._UZ(15,"ngx-datatable-column",12),e.TgZ(16,"ngx-datatable-column",13),e.YNc(17,I,5,1,"ng-template",14),e.qZA(),e._UZ(18,"ngx-datatable-column",15),e.TgZ(19,"ngx-datatable-column",16),e.YNc(20,L,2,2,"ng-template",14),e.qZA(),e._UZ(21,"ngx-datatable-column",17),e.TgZ(22,"ngx-datatable-column",18),e.YNc(23,J,2,1,"ng-template",14),e.qZA(),e.TgZ(24,"ngx-datatable-column",19),e.YNc(25,Y,2,1,"ng-template",14),e.qZA(),e.TgZ(26,"ngx-datatable-column",20),e.YNc(27,Q,2,1,"ng-template",14),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("routerLink","/vendors/add"),e.xp6(4),e.Q6J("ngIf",n.isLoading),e.xp6(5),e.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",n.rowsFilter),e.xp6(2),e.Q6J("width",50),e.xp6(3),e.Q6J("width",180))},dependencies:[h.O5,_.rH,v.nE,v.UC,v.vq],encapsulation:2}),o})();var s=c(4719),V=(c(2504),c(537)),F=c(362),U=c(398),k=c(4606),q=c(5195),P=c(5328),N=c(2668),C=c(551),x=c(2734);function O(o,a){1&o&&e._UZ(0,"div",43)}function H(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Name is required"),e.qZA())}function G(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Email is required"),e.qZA())}function R(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Please enter a valid email "),e.qZA())}function B(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Password is required"),e.qZA())}function K(o,a){if(1&o&&(e.TgZ(0,"span",45),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",null==t.selectedFile?null:t.selectedFile.name," ")}}function j(o,a){if(1&o&&(e.TgZ(0,"span",45),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",t.fileName," ")}}function $(o,a){1&o&&e._UZ(0,"span",49)}function z(o,a){if(1&o&&(e.TgZ(0,"div",46),e._UZ(1,"img",47),e.YNc(2,$,1,0,"span",48),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("src",t.fileUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",t.loading)}}function W(o,a){1&o&&(e.TgZ(0,"div")(1,"label"),e._uU(2,"Recommended (250*250)"),e.qZA()())}function X(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," City is required"),e.qZA())}function ee(o,a){if(1&o&&(e.TgZ(0,"option",66),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function te(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",50)(1,"div",51)(2,"div",13)(3,"div",52)(4,"span",53),e._uU(5),e.qZA(),e.TgZ(6,"select",54),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.onChangeCategory(r.target.value))}),e.TgZ(7,"option",55),e._uU(8,"Select Category"),e.qZA(),e.YNc(9,ee,2,2,"option",56),e.qZA()(),e.TgZ(10,"div",57),e._UZ(11,"input",58),e.TgZ(12,"span",59),e._uU(13,"%"),e.qZA()(),e.TgZ(14,"div",57),e._UZ(15,"input",60),e.TgZ(16,"span",59),e._uU(17,"SAR"),e.qZA()(),e.TgZ(18,"div",61),e._UZ(19,"input",62),e.qZA(),e.TgZ(20,"div",63)(21,"button",64),e.NdJ("click",function(){const i=e.CHM(t).index,l=e.oxw();return e.KtG(l.removeCategory(i))}),e._UZ(22,"em",65),e.qZA()()()()()}if(2&o){const t=a.index,n=e.oxw();e.xp6(1),e.Q6J("formGroupName",t),e.xp6(4),e.Oqu(t),e.xp6(4),e.Q6J("ngForOf",n.Categories)}}function ne(o,a){1&o&&e._UZ(0,"span",67)}function re(o,a){1&o&&e._UZ(0,"div",12)}function ie(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Name is required"),e.qZA())}function ae(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Email is required"),e.qZA())}function se(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," Please enter a valid email "),e.qZA())}function le(o,a){1&o&&(e.TgZ(0,"div",44),e._uU(1," City is required"),e.qZA())}function de(o,a){if(1&o&&(e.TgZ(0,"option",62),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function ce(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",45)(1,"div",46)(2,"div",47)(3,"div",48)(4,"span",49),e._uU(5),e.qZA(),e.TgZ(6,"select",50),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onChangeCategory(r.target.value))}),e.TgZ(7,"option",51),e._uU(8,"Select Category"),e.qZA(),e.YNc(9,de,2,2,"option",52),e.qZA()(),e.TgZ(10,"div",53),e._UZ(11,"input",54),e.TgZ(12,"span",55),e._uU(13,"%"),e.qZA()(),e.TgZ(14,"div",53),e._UZ(15,"input",56),e.TgZ(16,"span",55),e._uU(17,"SAR"),e.qZA()(),e.TgZ(18,"div",57),e._UZ(19,"input",58),e.qZA(),e.TgZ(20,"div",59)(21,"button",60),e.NdJ("click",function(){const i=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.removeCategory(i))}),e._UZ(22,"em",61),e.qZA()()()()()}if(2&o){const t=a.index,n=e.oxw(2);e.xp6(2),e.Q6J("formGroupName",t),e.xp6(3),e.Oqu(t),e.xp6(4),e.Q6J("ngForOf",n.Categories)}}function me(o,a){if(1&o&&(e.TgZ(0,"span",63),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" ",null==t.selectedFile?null:t.selectedFile.name," ")}}function ue(o,a){if(1&o&&(e.TgZ(0,"span",63),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.fileName," ")}}function pe(o,a){1&o&&e._UZ(0,"span",64)}function ge(o,a){1&o&&e._UZ(0,"span",65)}function fe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"form",13,14),e.NdJ("ngSubmit",function(r){e.CHM(t);const i=e.MAs(1),l=e.oxw();return e.KtG(l.editVendor(r,i.value))})("keydown.enter",function(r){return r.preventDefault()})("keydown.shift.enter",function(r){return r.preventDefault()}),e.TgZ(2,"div",15)(3,"div",16)(4,"label"),e._uU(5,"Name (ENGLISH)"),e.qZA(),e.TgZ(6,"input",17),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.vendorsDetailData.name=r)}),e.qZA(),e.YNc(7,ie,2,0,"div",18),e.qZA(),e.TgZ(8,"div",16)(9,"label"),e._uU(10,"Name (ARABIC)"),e.qZA(),e.TgZ(11,"input",19),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.vendorsDetailData.name_arabic=r)}),e.qZA()()(),e.TgZ(12,"div",15)(13,"div",16)(14,"label"),e._uU(15,"Email"),e.qZA(),e.TgZ(16,"input",20),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.vendorsDetailData.email=r)}),e.qZA(),e.YNc(17,ae,2,0,"div",18),e.YNc(18,se,2,0,"div",18),e.qZA(),e.TgZ(19,"div",21)(20,"div",22)(21,"label"),e._uU(22,"City"),e.qZA(),e.TgZ(23,"ngx-select",23),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.vendorsDetailData.city_id=r)})("data",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.value)}),e.qZA(),e.YNc(24,le,2,0,"div",18),e.qZA()()(),e.TgZ(25,"div",9)(26,"span",24),e._uU(27,"Settings"),e.qZA()(),e.YNc(28,ce,23,3,"div",25),e.TgZ(29,"div",15)(30,"div",26)(31,"a",27),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.addCategory())}),e._UZ(32,"em",28),e._uU(33,"Add more "),e.qZA()()(),e.TgZ(34,"div",15)(35,"div",29)(36,"div",22)(37,"label"),e._uU(38,"Choose image"),e.qZA(),e.TgZ(39,"label",30)(40,"button",31),e._uU(41," Select Image "),e._UZ(42,"em",32),e.qZA(),e.TgZ(43,"input",33),e.NdJ("input",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.onFileChanged(r))}),e.qZA(),e.YNc(44,me,2,1,"span",34),e.YNc(45,ue,2,1,"span",34),e.qZA()(),e.TgZ(46,"div",35),e._UZ(47,"img",36),e.YNc(48,pe,1,0,"span",37),e.qZA()()(),e.TgZ(49,"div",38)(50,"button",39),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(1);return e.KtG(r.resetForm({}))}),e._uU(51,"Clear"),e.qZA(),e.TgZ(52,"button",40),e._uU(53,"Save"),e.YNc(54,ge,1,0,"span",41),e.qZA(),e.TgZ(55,"span",42)(56,"ui-switch",43),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.vendorsDetailData.is_enabled=r)}),e.qZA(),e.TgZ(57,"label"),e._uU(58,"Active"),e.qZA()()()()}if(2&o){const t=e.oxw();e.Q6J("formGroup",t.valForm),e.xp6(6),e.Q6J("ngModel",t.vendorsDetailData.name),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.name.hasError("required")&&(t.valForm.controls.name.dirty||t.valForm.controls.name.touched)),e.xp6(4),e.Q6J("ngModel",t.vendorsDetailData.name_arabic),e.xp6(5),e.Q6J("ngModel",t.vendorsDetailData.email)("pattern",t.emailPattern),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.email.hasError("required")&&(t.valForm.controls.email.dirty||t.valForm.controls.email.touched)),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.email.hasError("pattern")&&(t.valForm.controls.email.dirty||t.valForm.controls.email.touched)),e.xp6(5),e.Q6J("ngModel",t.vendorsDetailData.city_id)("multiple",!0)("items",t.cityItems)("disabled",t.disabled),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.city_id.hasError("required")&&(t.valForm.controls.city_id.dirty||t.valForm.controls.city_id.touched)),e.xp6(4),e.Q6J("ngForOf",t.controls),e.xp6(16),e.Q6J("ngIf",null==t.selectedFile?null:t.selectedFile.name),e.xp6(1),e.Q6J("ngIf",!(null!=t.selectedFile&&t.selectedFile.name)),e.xp6(2),e.Q6J("src",t.fileUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(6),e.Q6J("ngIf",t.saveLoading),e.xp6(2),e.Q6J("ngModel",t.vendorsDetailData.is_enabled)}}const _e=[{path:"",component:w},{path:"shops",component:w},{path:"add",component:(()=>{class o{constructor(t,n,r,i,l,d,m,p,g,f,ve){this.fb=t,this.afs=n,this.router=r,this.vendorsService=i,this.validationService=l,this.fireStorage=d,this.userService=m,this.categoryService=p,this.authService=g,this.cdref=f,this.citiesService=ve,this.cityItems=[],this.value={},this.disabled=!1,this.loading=!1,this.saveLoading=!1,this.swithcButtonEnabled=!1,this.switchButtonText="This vendor will be shown when there are products available.",this.showPreviewBox=!1,this.Categories=[],this.emailPattern=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,this.valForm=t.group({name:["",s.kI.required],name_arabic:"",email:["",s.kI.required],password:["",s.kI.required],image:"",isEnabled:[!0,s.kI.required],currencySarValue:[!1,s.kI.required],currencyPercentValue:[!1,s.kI.required],cat_id:[!1,s.kI.required],productLimitation:[!1,s.kI.required],city_id:[!1,s.kI.required],category:this.fb.array([])})}ngOnInit(){this.uid=sessionStorage.getItem("uid"),this.loginType=sessionStorage.getItem("loginType"),this.userType=sessionStorage.getItem("store-owner"),null==this.userType&&this.authService.SignOut(),this.categoryService.getCategoryList().subscribe(t=>{this.Categories=t.map(n=>{let r=n.payload.doc.data();return{id:n.payload.doc.id,...r}})}),this.getCitiesList(),this.category().push(this.newCategory())}getCitiesList(){this.citiesService.getCitiesList().subscribe(t=>{this.cityItems=[],t.map(n=>{let i={text:n.payload.doc.data().name_arabic,id:n.payload.doc.id};this.cityItems.push(i)})})}ngAfterContentChecked(){this.cdref.detectChanges()}onFileChanged(t){if(t){if(this.selectedFile=t.target.files[0],this.fileUrl=this.selectedFile.src,0===this.selectedFile.length)return;const n=new FileReader;n.readAsDataURL(this.selectedFile),n.onload=r=>{this.fileUrl=n.result,this.showPreviewBox=!0}}}addVendor(t,n){t.preventDefault();for(let r in this.valForm.controls)this.valForm.controls[r].markAsTouched();if(this.valForm.valid&&this.selectedFile){const r=this.selectedFile,i=Date.now(),l="/vendors",m=this.fireStorage.ref(`${l}/${i}-${r.name}`);this.fireStorage.upload(`${l}/${i}-${r.name}`,r).snapshotChanges().pipe((0,V.x)(()=>{m.getDownloadURL().subscribe(f=>{f&&(this.fileUrl=f,this.saveStoreToDB(n,f))})})).subscribe(g=>{})}else this.valForm.valid?this.saveStoreToDB(n,""):console.log("this.valForm",this.valForm)}ngAfterViewInit(){}registerUser(t){const{email:n,password:r}=t;return new Promise((i,l)=>{u.Z.auth().createUserWithEmailAndPassword(n,r).then(d=>(this.user_id=d.user.uid,i(d))).catch(d=>l(d))})}onChangeCategory(t){this.category_id=t}category(){return this.valForm.get("category")}newCategory(){return this.fb.group({cat_id:"",currencySarValue:"",currencyPercentValue:"",productLimitation:""})}onSwitchChanged(t){this.switchButtonText=1==t?"This vendor will be shown when there are products available.":"This vendor will be hidden in the app."}addCategory(){this.category().push(this.newCategory())}removeCategory(t){this.category().removeAt(t)}saveStoreToDB(t,n){this.saveLoading=!0,this.registerUser(t).then(()=>{let r={name:t.name,name_arabic:t.name_arabic,uid:this.user_id,created_at:u.Z.firestore.FieldValue.serverTimestamp(),updated_at:u.Z.firestore.FieldValue.serverTimestamp(),created_by:this.uid,is_enabled:t.isEnabled,email:t.email,image:n,city_id:t.city_id||[],categories:t.category||{},deleted_at:null,deleted_by:null,disabled:!1,deleted_by_user_type:null};this.vendorsService.addVendor(r).then(i=>{let l={uid:this.user_id,type:this.userType,image:n,name:t.name,name_arabic:t.name_arabic,email:t.email,city_id:t.city_id||[],categories:t.category||{},created_at:u.Z.firestore.FieldValue.serverTimestamp(),updated_at:u.Z.firestore.FieldValue.serverTimestamp(),created_by:this.uid,deleted_at:null,deleted_by:null,disabled:!1,deleted_by_user_type:null},d=[];t.category.forEach(p=>{d.push(p.cat_id)}),1==d.some((p,g)=>d.indexOf(p)!==g)?(console.log("duplicates found"),this.validationService.sweetalertError("Duplicate category, please choose another")):(console.log("duplicates not found"),this.userService.addUser(l).then(()=>{console.log("User Data added successfully!")}).catch(p=>{console.log(p)}),this.afs.collection("settings").doc("counts").update({"counts.vendors":u.Z.firestore.FieldValue.increment(1)}).then(p=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/vendors"])}).catch(()=>{this.loading=!1,this.saveLoading=!1}))}).catch(i=>{console.log(i),this.loading=!1,this.saveLoading=!1})}).catch(r=>{console.log("error",r),this.validationService.sweetalertError(r.message),this.saveLoading=!1})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(s.QS),e.Y36(b.ST),e.Y36(_.F0),e.Y36(y.m),e.Y36(F.R),e.Y36(U.Q1),e.Y36(k.K),e.Y36(q.H),e.Y36(P.e),e.Y36(e.sBO),e.Y36(N.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-vendors-add"]],decls:78,vars:19,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-arrow-left","mr-1"],[1,"row"],[1,"col-md-12"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card","card-default"],[1,"card-body"],[1,"d-flex","align-items-center"],[2,"color","#656565","font-size","28px","margin-bottom","10px"],["role","form","autocomplete","off",1,"form-validate",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter"],["dataPost","ngForm"],[1,"form-row"],[1,"col-lg-6","mb-3"],["autocomplete","off","required","","formControlName","name","ngModel","","name","name","type","text","placeholder","Enter name",1,"form-control","with-focus"],["class","text-danger",4,"ngIf"],["autocomplete","off","formControlName","name_arabic","ngModel","","name","name_arabic","type","text","placeholder","Enter name",1,"form-control","with-focus"],["autocomplete","off","required","","formControlName","email","ngModel","","name","email","type","text","placeholder","Enter email",1,"form-control","with-focus",3,"pattern"],["autocomplete","off","required","","formControlName","password","ngModel","","name","password","type","password","placeholder","Enter password",1,"form-control","with-focus"],[1,"col-lg-6","mb-4"],[1,"form-group"],["for","image-input",1,"file-upload"],[1,"btn","btn-secondary"],[1,"far","fa-folder-open","mr"],["ngModel","","placeholder","Choose image","type","file","formControlName","image","name","image","accept",".jpeg,.jpg,.png,.svg",1,"form-control",3,"input"],["class","form-control",4,"ngIf"],["class","image-preview-box",4,"ngIf"],[4,"ngIf"],[1,"col-lg-5","mb-4"],["required","","ngModel","","formControlName","city_id","name","city_id","optionValueField","id","optionTextField","text","placeholder","Select cities",3,"multiple","items","disabled","data"],[2,"color","#656565","font-size","28px","margin-bottom","30px"],["class","form-row","formArrayName","category",4,"ngFor","ngForOf"],[1,"col-12","mb-3"],[1,"btn","btn-success",3,"click"],["_ngcontent-lgi-c20","",1,"fa","fa-plus","mr-1"],[2,"display","flex","align-items","center","margin-top","15px"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],["type","submit",1,"btn","btn-sm","btn-info"],["class","spinner-border spinner-border-sm ml-2",4,"ngIf"],[2,"display","flex","align-items","center","margin-left","15px","gap","10px"],["formControlName","isEnabled",3,"change"],[1,"mb-0"],["role","status",1,"spinner-border","loading"],[1,"text-danger"],[1,"form-control"],[1,"image-preview-box"],["onerror","this.onerror=null;this.src='assets/img/preview-img.png';",1,"previewImage",3,"src"],["class","spinner-border spinner-border-sm custom-spinner",4,"ngIf"],[1,"spinner-border","spinner-border-sm","custom-spinner"],["formArrayName","category",1,"form-row"],[1,"col-12",3,"formGroupName"],[1,"col-3","mb-3","d-flex","align-items-center"],[1,"mr-2"],["formControlName","cat_id","ngModel","","name","cat_id",1,"custom-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-3","mb-3","commission-box"],["autocomplete","off","type","text","formControlName","currencyPercentValue","ngModel","","name","currencyPercentValue","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter % value",1,"form-control"],[1,"currencyType"],["autocomplete","off","type","text","formControlName","currencySarValue","ngModel","","name","currencySarValue","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter SAR value",1,"form-control"],[1,"col-2","mb-3","d-flex","align-items-center"],["autocomplete","off","formControlName","productLimitation","ngModel","","name","productLimitation","min","0","type","number","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter Product limitation",1,"form-control","with-focus"],[1,"col-1","mb-3","d-flex","align-items-center"],[1,"btn","btn-outline-danger","btn-sm","d-flex","align-items-center",3,"click"],["_ngcontent-lgi-c20","",1,"fa","fa-times"],[3,"value"],[1,"spinner-border","spinner-border-sm","ml-2"]],template:function(t,n){if(1&t){const r=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Add Vendor"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Back "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5),e.YNc(9,O,1,0,"div",6),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",10),e._uU(14,"Branding"),e.qZA()(),e.TgZ(15,"form",11,12),e.NdJ("ngSubmit",function(l){e.CHM(r);const d=e.MAs(16);return e.KtG(n.addVendor(l,d.value))})("keydown.enter",function(l){return l.preventDefault()})("keydown.shift.enter",function(l){return l.preventDefault()}),e.TgZ(17,"div",13)(18,"div",14)(19,"label"),e._uU(20,"Name (ENGLISH)"),e.qZA(),e._UZ(21,"input",15),e.YNc(22,H,2,0,"div",16),e.qZA(),e.TgZ(23,"div",14)(24,"label"),e._uU(25,"Name (ARABIC)"),e.qZA(),e._UZ(26,"input",17),e.qZA()(),e.TgZ(27,"div",13)(28,"div",14)(29,"label"),e._uU(30,"Email (This email will be used to notify vendor.)"),e.qZA(),e._UZ(31,"input",18),e.YNc(32,G,2,0,"div",16),e.YNc(33,R,2,0,"div",16),e.qZA(),e.TgZ(34,"div",14)(35,"label"),e._uU(36,"Password"),e.qZA(),e._UZ(37,"input",19),e.YNc(38,B,2,0,"div",16),e.qZA()(),e.TgZ(39,"div",13)(40,"div",20)(41,"div",21)(42,"label"),e._uU(43,"Brand Logo (This appears best if used square.)"),e.qZA(),e.TgZ(44,"label",22)(45,"button",23),e._uU(46," Select Image "),e._UZ(47,"em",24),e.qZA(),e.TgZ(48,"input",25),e.NdJ("input",function(l){return n.onFileChanged(l)}),e.qZA(),e.YNc(49,K,2,1,"span",26),e.YNc(50,j,2,1,"span",26),e.qZA()(),e.YNc(51,z,3,2,"div",27),e.YNc(52,W,3,0,"div",28),e.qZA(),e.TgZ(53,"div",29)(54,"div",21)(55,"label"),e._uU(56,"Cities"),e.qZA(),e.TgZ(57,"ngx-select",30),e.NdJ("data",function(){return n.value}),e.qZA(),e.YNc(58,X,2,0,"div",16),e.qZA()()(),e.TgZ(59,"div",9)(60,"span",31),e._uU(61,"Settings"),e.qZA()(),e.YNc(62,te,23,3,"div",32),e.TgZ(63,"div",13)(64,"div",33)(65,"a",34),e.NdJ("click",function(){return n.addCategory()}),e._UZ(66,"em",35),e._uU(67,"Add more "),e.qZA()()(),e.TgZ(68,"div",36)(69,"button",37),e.NdJ("click",function(){e.CHM(r);const l=e.MAs(16);return e.KtG(l.resetForm({}))}),e._uU(70,"Clear"),e.qZA(),e.TgZ(71,"button",38),e._uU(72,"Save"),e.YNc(73,ne,1,0,"span",39),e.qZA(),e.TgZ(74,"span",40)(75,"ui-switch",41),e.NdJ("change",function(l){return n.onSwitchChanged(l)}),e.qZA(),e.TgZ(76,"label",42),e._uU(77),e.qZA()()()()()()()()}2&t&&(e.xp6(4),e.Q6J("routerLink","/vendors"),e.xp6(5),e.Q6J("ngIf",n.loading),e.xp6(6),e.Q6J("formGroup",n.valForm),e.xp6(7),e.Q6J("ngIf",n.valForm.controls.name.hasError("required")&&(n.valForm.controls.name.dirty||n.valForm.controls.name.touched)),e.xp6(9),e.Q6J("pattern",n.emailPattern),e.xp6(1),e.Q6J("ngIf",n.valForm.controls.email.hasError("required")&&(n.valForm.controls.email.dirty||n.valForm.controls.email.touched)),e.xp6(1),e.Q6J("ngIf",n.valForm.controls.email.hasError("pattern")&&(n.valForm.controls.email.dirty||n.valForm.controls.email.touched)),e.xp6(5),e.Q6J("ngIf",n.valForm.controls.password.hasError("required")&&(n.valForm.controls.password.dirty||n.valForm.controls.password.touched)),e.xp6(11),e.Q6J("ngIf",null==n.selectedFile?null:n.selectedFile.name),e.xp6(1),e.Q6J("ngIf",!(null!=n.selectedFile&&n.selectedFile.name)),e.xp6(1),e.Q6J("ngIf",n.showPreviewBox),e.xp6(1),e.Q6J("ngIf",n.showPreviewBox),e.xp6(5),e.Q6J("multiple",!0)("items",n.cityItems)("disabled",n.disabled),e.xp6(1),e.Q6J("ngIf",n.valForm.controls.city_id.hasError("required")&&(n.valForm.controls.city_id.dirty||n.valForm.controls.city_id.touched)),e.xp6(4),e.Q6J("ngForOf",n.category().controls),e.xp6(11),e.Q6J("ngIf",n.saveLoading),e.xp6(4),e.Oqu(n.switchButtonText))},dependencies:[h.sg,h.O5,s._Y,s.YN,s.Kr,s.Fj,s.wV,s.EJ,s.JJ,s.JL,s.Q7,s.c5,s.qQ,s.sg,s.u,s.x0,s.CE,_.rH,C.O2,x.ob],styles:[".commission-box[_ngcontent-%COMP%]{position:relative}.currencyType[_ngcontent-%COMP%]{position:absolute;right:15px;color:#f05050;font-weight:700;font-size:14px}.ranjeeta[_ngcontent-%COMP%]   button.switch.checked.switch-medium[_ngcontent-%COMP%]{display:inline!important;margin-left:10px!important}"]}),o})()},{path:"edit/:id",component:(()=>{class o{constructor(t,n,r,i,l,d,m,p,g){this.fb=t,this.afs=n,this.router=r,this.route=i,this.vendorsService=l,this.validationService=d,this.fireStorage=m,this.categoryService=p,this.citiesService=g,this.cityItems=[],this.value={},this.disabled=!1,this.loading=!1,this.saveLoading=!1,this.Categories=[],this.emailPattern=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,this.valForm=t.group({name:["",s.kI.required],name_arabic:"",email:["",s.kI.required],image:"",isEnabled:[!0,s.kI.required],categoryArr:this.fb.array([]),city_id:[!1,s.kI.required]})}ngOnInit(){this.id=this.route.snapshot.params.id,this.vendorsService.getVendorDetail(this.id).get().subscribe(t=>{t.exists&&(this.vendorsDetailData=t.data(),this.fileName=this.vendorsDetailData.image,this.fileUrl=this.vendorsDetailData.image,this.setCatgory())}),this.categoryService.getCategoryList().subscribe(t=>{this.Categories=t.map(n=>{let r=n.payload.doc.data();return{id:n.payload.doc.id,...r}})}),this.getCitiesList()}getCitiesList(){this.citiesService.getCitiesList().subscribe(t=>{this.cityItems=[],t.map(n=>{let i={text:n.payload.doc.data().name_english,id:n.payload.doc.id};this.cityItems.push(i)})})}onFileChanged(t){if(t){if(this.selectedFile=t.target.files[0],this.fileUrl=this.selectedFile.src,0===this.selectedFile.length)return;const n=new FileReader;n.readAsDataURL(this.selectedFile),n.onload=r=>{this.fileUrl=n.result}}}editVendor(t,n){t.preventDefault();for(let r in this.valForm.controls)this.valForm.controls[r].markAsTouched();if(this.valForm.valid&&this.selectedFile){const r=this.selectedFile,i=Date.now(),l="/vendors",m=this.fireStorage.ref(`${l}/${i}-${r.name}`);this.fireStorage.upload(`${l}/${i}-${r.name}`,r).snapshotChanges().pipe((0,V.x)(()=>{m.getDownloadURL().subscribe(f=>{f&&(this.fileUrl=f,this.updateStoreToDB(n,f))})})).subscribe(g=>{g&&(this.loading=!1)})}else this.valForm.valid?this.updateStoreToDB(n,this.fileUrl):console.log("this.valForm",this.valForm)}ngAfterViewInit(){}onChangeCategory(t){this.category_id=t}category(){return this.valForm.controls.categoryArr}get controls(){return this.valForm.get("categoryArr").controls}setCatgory(){const t=this.valForm.controls.categoryArr;this.vendorsDetailData.categories.forEach(n=>{t.push(this.fb.group({cat_id:n.cat_id,currencySarValue:n.currencySarValue,currencyPercentValue:n.currencyPercentValue,productLimitation:n.productLimitation}))})}addCategory(){this.valForm.controls.categoryArr.push(this.fb.group({cat_id:"",currencySarValue:"",currencyPercentValue:"",productLimitation:""}))}removeCategory(t){this.category().removeAt(t)}updateStoreToDB(t,n){this.saveLoading=!0,null==t.name_arabic&&null==t.name_arabic&&(t.name_arabic="");let r={name:t.name,name_arabic:t.name_arabic,categories:t.categoryArr||{},created_at:u.Z.firestore.FieldValue.serverTimestamp(),updated_at:u.Z.firestore.FieldValue.serverTimestamp(),is_enabled:t.isEnabled,email:t.email,city_id:t.city_id||[],image:n};console.log("postData",r);let i=[];t.categoryArr.forEach(d=>{i.push(d.cat_id)}),1==i.some((d,m)=>i.indexOf(d)!==m)?(console.log("duplicates found"),this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertError("Duplicate category, please choose another")):(console.log("duplicates not found"),this.vendorsService.updateVendor(this.id,r).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.vendors":u.Z.firestore.FieldValue.increment(1)}).then(d=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/vendors"])}).catch(()=>{this.loading=!1,this.saveLoading=!1})}).catch(d=>{console.log(d),this.loading=!1,this.saveLoading=!1}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(s.QS),e.Y36(b.ST),e.Y36(_.F0),e.Y36(_.gz),e.Y36(y.m),e.Y36(F.R),e.Y36(U.Q1),e.Y36(q.H),e.Y36(N.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-vendors-edit"]],decls:16,vars:3,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-arrow-left","mr-1"],[1,"row"],[1,"col-md-12"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card","card-default"],[1,"card-body"],[1,"d-flex","align-items-center"],[2,"color","#656565","font-size","28px","margin-bottom","10px"],["class","form-validate","role","form","autocomplete","off",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter",4,"ngIf"],["role","status",1,"spinner-border","loading"],["role","form","autocomplete","off",1,"form-validate",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter"],["dataPost","ngForm"],[1,"form-row"],[1,"col-lg-6","mb-3"],["autocomplete","off","required","","formControlName","name","name","name","type","text","placeholder","Enter name",1,"form-control","with-focus",3,"ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],["autocomplete","off","formControlName","name_arabic","name","name_arabic","type","text","placeholder","Enter name",1,"form-control","with-focus",3,"ngModel","ngModelChange"],["autocomplete","off","required","","formControlName","email","name","email","type","text","placeholder","Enter email",1,"form-control","with-focus",3,"ngModel","pattern","ngModelChange"],[1,"col-lg-5","mb-4"],[1,"form-group"],["required","","formControlName","city_id","name","city_id","optionValueField","id","optionTextField","text","placeholder","Select cities",3,"ngModel","multiple","items","disabled","ngModelChange","data"],[2,"color","#656565","font-size","28px","margin-bottom","30px"],["class","form-row","formArrayName","categoryArr",4,"ngFor","ngForOf"],[1,"col-12","mb-3"],[1,"btn","btn-success",3,"click"],["_ngcontent-lgi-c20","",1,"fa","fa-plus","mr-1"],[1,"col-lg-6","mb-4"],["for","image-input",1,"file-upload"],[1,"btn","btn-secondary"],[1,"far","fa-folder-open","mr"],["ngModel","","placeholder","Choose image","type","file","formControlName","image","name","image","accept",".jpeg,.jpg,.png,.svg",1,"form-control",3,"input"],["class","form-control",4,"ngIf"],[1,"image-preview-box"],["onerror","this.onerror=null;this.src='assets/img/preview-img.png';",1,"previewImage",3,"src"],["class","spinner-border spinner-border-sm custom-spinner",4,"ngIf"],[2,"display","flex","align-items","center","margin-top","15px"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],["type","submit",1,"btn","btn-sm","btn-info"],["class","spinner-border spinner-border-sm ml-2",4,"ngIf"],[2,"display","flex","align-items","center","margin-left","15px","gap","10px"],["formControlName","isEnabled",3,"ngModel","ngModelChange"],[1,"text-danger"],["formArrayName","categoryArr",1,"form-row"],[1,"col-12"],[1,"form-row",3,"formGroupName"],[1,"col-3","mb-3","d-flex","align-items-center"],[1,"mr-2"],["formControlName","cat_id",1,"custom-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-3","mb-3","commission-box"],["autocomplete","off","type","text","formControlName","currencyPercentValue","name","currencyPercentValue","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter % value",1,"form-control"],[1,"currencyType"],["autocomplete","off","type","text","formControlName","currencySarValue","name","currencySarValue","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter SAR value",1,"form-control"],[1,"col-2","mb-3","d-flex","align-items-center"],["autocomplete","off","formControlName","productLimitation","type","number","onkeypress","return event.charCode >= 48 && event.charCode <= 57","placeholder","Enter Product limitation",1,"form-control","with-focus"],[1,"col-1","mb-3","d-flex","align-items-center"],[1,"btn","btn-outline-danger","btn-sm","d-flex","align-items-center",3,"click"],["_ngcontent-lgi-c20","",1,"fa","fa-times"],[3,"value"],[1,"form-control"],[1,"spinner-border","spinner-border-sm","custom-spinner"],[1,"spinner-border","spinner-border-sm","ml-2"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Edit Vendor"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Back "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5),e.YNc(9,re,1,0,"div",6),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",10),e._uU(14,"Branding"),e.qZA()(),e.YNc(15,fe,59,20,"form",11),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("routerLink","/vendors"),e.xp6(5),e.Q6J("ngIf",n.loading),e.xp6(6),e.Q6J("ngIf",n.vendorsDetailData))},dependencies:[h.sg,h.O5,s._Y,s.YN,s.Kr,s.Fj,s.wV,s.EJ,s.JJ,s.JL,s.Q7,s.c5,s.sg,s.u,s.x0,s.CE,_.rH,C.O2,x.ob],styles:[".commission-box[_ngcontent-%COMP%]{position:relative}.currencyType[_ngcontent-%COMP%]{position:absolute;right:15px;color:#f05050;font-weight:700;font-size:14px}"]}),o})()}];let he=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[D.m,v.xD,C.i4,h.ez,x.Su,_.Bz.forChild(_e)]}),o})()}}]);