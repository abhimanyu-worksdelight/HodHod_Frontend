(self.webpackChunkng2angle=self.webpackChunkng2angle||[]).push([[649],{8649:(qe,Ze,S)=>{"use strict";S.r(Ze),S.d(Ze,{ProductsModule:()=>Ce});var de=S(6895),X=S(6691),we=S(5229),D=S(1071),I=S(5867),e=(S(6776),S(4650)),Te=S(4632),v=S(8064),pe=S(3028);let ie=(()=>{let o=class{constructor(){this._papa=pe}parse(t,i){return this._papa.parse(t,i)}unparse(t,i){return this._papa.unparse(t,i)}setLocalChunkSize(t){this._papa.LocalChunkSize=t}setRemoteChunkSize(t){this._papa.RemoteChunkSize=t}setDefaultDelimiter(t){this._papa.DefaultDelimiter=t}get badDelimiters(){return this._papa.BAD_DELIMITERS}get recordSeparator(){return this._papa.RECORD_SEP}get unitSeparator(){return this._papa.UNIT_SEP}get workersSupported(){return this._papa.WORKERS_SUPPORTED}};return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=(0,e.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();var ce=S(362);const _e=["csvReader"];function fe(o,f){1&o&&e._UZ(0,"div",20)}function ve(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"div",22)(2,"input",23),e.NdJ("change",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.handleFileSelect(a))}),e.qZA(),e.TgZ(3,"label",24)(4,"span"),e._uU(5,"Upload CSV file to database"),e.qZA()()()()}}function De(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"button",26),e._UZ(2,"em",27),e.qZA(),e.TgZ(3,"button",28),e.NdJ("click",function(){const a=e.CHM(t),s=a.value,d=a.row,T=e.oxw();return e.KtG(T.deleteProductData(s,d))}),e._UZ(4,"em",29),e.qZA()()}if(2&o){const t=f.value;e.xp6(1),e.MGl("routerLink","/products/edit/",t,"")}}function me(o,f){if(1&o&&e._UZ(0,"img",32),2&o){const t=e.oxw().value;e.s9C("src",t,e.LSH)}}function xe(o,f){1&o&&e._UZ(0,"img",33)}function Ee(o,f){if(1&o&&(e.YNc(0,me,1,1,"img",30),e.YNc(1,xe,1,0,"img",31)),2&o){const t=f.value;e.Q6J("ngIf",t),e.xp6(1),e.Q6J("ngIf",!t)}}function Ae(o,f){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=f.value;e.xp6(1),e.Oqu(1==t?"Yes":"No")}}const be=S(1373);let ye=(()=>{class o{constructor(t,i,a,s){this.productsService=t,this.afs=i,this.papa=a,this.validationService=s,this.records=[],this.Products=[],this.arrayRowData="",this.rowsFilter=[],this.arrayTableData=[],this.arrayRowTableData=[],this.isLoading=!1,this.allStoreIds=[],this.csvArr=[]}ngOnInit(){this.loginType=sessionStorage.getItem("loginType"),this.uid=sessionStorage.getItem("uid"),this.afs.collection("vendors",t=>t.where("uid","==",this.uid)).get().subscribe(t=>{t.forEach(i=>{this.vendor_id=i.id})}),this.getProductsList()}getProductsList(){this.Products=[],this.rowsFilter=[],this.arrayRowData=[],this.arrayTableData=[],"u7GeGmO2luLmkOMKeZ0k"==this.loginType?(this.Products=[],this.rowsFilter=[],this.arrayRowData=[],this.arrayTableData=[],this.afs.collection("vendors",t=>t.where("uid","==",this.uid)).snapshotChanges().subscribe(t=>{t.length&&t.map(i=>{this.afs.collection("shops",a=>a.where("vendor_id","==",i.payload.doc.id)).snapshotChanges().subscribe(a=>{a.length&&a.map(s=>{this.afs.collection("products",d=>d.where("store_id","array-contains",s.payload.doc.id)).snapshotChanges().subscribe(d=>{if(this.isLoading=!0,this.Products=[],this.rowsFilter=[],this.arrayRowData=[],this.arrayTableData=[],d.length){this.Products=d.map(T=>{let N=T.payload.doc.data();return{id:T.payload.doc.id,data:N}}),this.arrayTableData=[];for(let T=0;T<this.Products.length;T++)this.arrayRowData=this.Products[T].data,this.arrayRowData.sr_no=T+1,this.arrayRowData.id=this.Products[T].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1;if(this.arrayTableData){for(let T=0;T<this.arrayTableData.length;T++)this.arrayTableData[T].store_id&&(this.allStoreIds=[...new Set(this.arrayTableData[T].store_id)]);this.allStoreIds&&this.allStoreIds.length&&(this.rowsFilter=[],this.productsService.getShopsByIds(this.allStoreIds.flat()).then(T=>{const N=T,j=this.arrayTableData.length;this.arrayRowTableData=[];for(let P=0;P<j;P++){let B=this.arrayTableData[P];const se=N.filter(he=>B.store_id.includes(he.id)),le=B;le.sr_no=P+1,le.store_id=se.map(he=>he.data.name).join(", "),this.arrayRowTableData.push(le)}this.rowsFilter=this.arrayRowTableData}))}}else this.isLoading=!1})})})})})):this.productsService.getProductsList().subscribe(t=>{if(this.isLoading=!0,this.Products=[],this.rowsFilter=[],this.arrayRowData=[],this.arrayTableData=[],t.length){this.Products=[],this.Products=t.map(i=>{let a=i.payload.doc.data();return{id:i.payload.doc.id,data:a}}),this.arrayTableData=[];for(let i=0;i<this.Products.length;i++)this.arrayRowData=this.Products[i].data,this.arrayRowData.sr_no=i+1,this.arrayRowData.id=this.Products[i].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1;if(this.arrayTableData){for(let i=0;i<this.arrayTableData.length;i++)this.arrayTableData[i].store_id&&this.allStoreIds.push(this.arrayTableData[i].store_id);this.allStoreIds&&this.allStoreIds.length&&(this.rowsFilter=[],this.productsService.getShopsByIds(this.allStoreIds.flat()).then(i=>{const a=i,s=this.arrayTableData.length;this.arrayRowTableData=[];for(let d=0;d<s;d++){let T=this.arrayTableData[d];const N=a.filter(P=>T.store_id.includes(P.id)),j=T;j.sr_no=d+1,j.store_id=N.map(P=>P.data.name).join(", "),this.arrayRowTableData.push(j)}this.rowsFilter=this.arrayRowTableData}))}}else this.isLoading=!1})}updateFilter(t){const i=t.target.value.toLowerCase(),a=this.arrayTableData.filter(function(s){if(""!=s.store_id&&null!=s.store_id)return-1!==s.name.toLowerCase().indexOf(i)||!i});this.rowsFilter=a,this.table.offset=0}handleFileSelect(t){if(this.isValidCSVFile(t.srcElement.files[0])){let a=t.target,s=new FileReader;s.readAsText(a.files[0]),s.onload=()=>{let d=s.result.toString();this.papa.parse(d,{complete:(N,j)=>{console.log("Parsed: results",N.data),this.saveProductToDB(N.data)}})},s.onerror=function(){console.log("error is occured while reading file!")}}else alert("Please import valid .csv file."),this.fileReset()}isValidCSVFile(t){return t.name.endsWith(".csv")}fileReset(){this.csvReader.nativeElement.value="",this.records=[]}deleteProductData(t,i){this.sweetalertWarning(t,i)}saveProductToDB(t){t.forEach((i,a)=>{if(0==a)return 1;let s={name:i[0],name_arabic:i[1],cat_id:i[2],inSection_id:i[3]||[],store_id:i[4],price:parseInt(i[5]),created_at:I.Z.firestore.FieldValue.serverTimestamp(),updated_at:I.Z.firestore.FieldValue.serverTimestamp(),created_by:this.uid,is_enabled:i[9],description:i[10],description_arabic:i[11],image:i[12]||"",previewImage:i[13]||"",deleted_at:null,deleted_by:null,disabled:!1,deleted_by_user_type:null};s&&this.productsService.addProdct(s).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(1)}).then(d=>{console.log("Product count updated!",d)}).catch(d=>{console.log("error",d)}),t.length-1==a&&this.validationService.sweetalertSuccess()}).catch(d=>{console.log(d)})})}sweetalertWarning(t,i){be({title:"Are you sure?",text:"Want to delete data!",icon:"warning",buttons:{cancel:{text:"Cancel",value:null,visible:!0,className:"",closeModal:!0},confirm:{text:"Yes, delete it!",value:!0,visible:!0,className:"bg-danger",closeModal:!1}}}).then(a=>{a&&this.productsService.deleteProduct(t).then(()=>{if("u7GeGmO2luLmkOMKeZ0k"==this.loginType){var s={};s[`categories.${i.cat_id}`]=I.Z.firestore.FieldValue.increment(-1),this.afs.collection("vendors").doc(this.vendor_id).update(s).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(-1)}).then(()=>{this.getProductsList(),be("Deleted!","Data deletd!","success")})})}else this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(-1)}).then(()=>{this.getProductsList(),be("Deleted!","Data deletd!","success")})})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Te.s),e.Y36(v.ST),e.Y36(ie),e.Y36(ce.R))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-products-list"]],viewQuery:function(t,i){if(1&t&&(e.Gf(D.nE,7),e.Gf(_e,5)),2&t){let a;e.iGM(a=e.CRH())&&(i.table=a.first),e.iGM(a=e.CRH())&&(i.csvReader=a.first)}},decls:25,vars:11,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-plus","mr-1"],[1,"card","card-default"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card-body"],[1,"row","mb-3"],[1,"col-lg-3"],["type","text","placeholder","Type to filter the store column...",1,"form-control",3,"keyup"],["class","col-lg-9 d-flex justify-content-end align-items-center",4,"ngIf"],[1,"bootstrap","no-detail-row",3,"scrollbarH","columnMode","footerHeight","rowHeight","limit","rows"],["table",""],["name","Sr. No.","prop","sr_no",3,"width"],["name","Actions","sortable","false","prop","id"],["ngx-datatable-cell-template",""],["name","Unique Id","prop","id",3,"width"],["name","Image","sortable","false","prop","image"],["name","Name","prop","name"],["name","Active","prop","is_enabled"],["role","status",1,"spinner-border","loading"],[1,"col-lg-9","d-flex","justify-content-end","align-items-center"],[1,"file-input"],["type","file","name","file-input","id","file-input","accept",".csv",1,"csvFileInput",3,"change"],["for","file-input",1,"fileInputLabel","bg-warning","mb-0"],[1,"d-flex"],["type","button",1,"mr-1","btn","btn-success","comn-action-btn","mb-1",3,"routerLink"],["_ngcontent-lgi-c20","",1,"fas","fa-edit"],["type","button",1,"mr-1","btn","btn-danger","comn-action-btn","mb-1",3,"click"],["_ngcontent-lgi-c20","",1,"fas","fa-trash-alt"],["class","listImage",3,"src",4,"ngIf"],["src","assets/img/preview-img.png","class","listImage",4,"ngIf"],[1,"listImage",3,"src"],["src","assets/img/preview-img.png",1,"listImage"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Products"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Add New "),e.qZA()()(),e.TgZ(7,"div",4),e.YNc(8,fe,1,0,"div",5),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"input",9),e.NdJ("keyup",function(s){return i.updateFilter(s)}),e.qZA()(),e.YNc(13,ve,6,0,"div",10),e.qZA(),e.TgZ(14,"ngx-datatable",11,12),e._UZ(16,"ngx-datatable-column",13),e.TgZ(17,"ngx-datatable-column",14),e.YNc(18,De,5,1,"ng-template",15),e.qZA(),e._UZ(19,"ngx-datatable-column",16),e.TgZ(20,"ngx-datatable-column",17),e.YNc(21,Ee,2,2,"ng-template",15),e.qZA(),e._UZ(22,"ngx-datatable-column",18),e.TgZ(23,"ngx-datatable-column",19),e.YNc(24,Ae,2,1,"ng-template",15),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("routerLink","/products/add"),e.xp6(4),e.Q6J("ngIf",i.isLoading),e.xp6(5),e.Q6J("ngIf","WxAsS1whStfbgdXvxqHs"==i.loginType),e.xp6(1),e.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",i.rowsFilter),e.xp6(2),e.Q6J("width",50),e.xp6(3),e.Q6J("width",180))},dependencies:[de.O5,X.rH,D.nE,D.UC,D.vq],styles:[".csvFileInput{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.fileInputLabel{cursor:pointer;display:inline-flex;align-items:center;border-radius:4px;font-size:14px;font-weight:600;padding:7px 12px;box-shadow:0 0 2px #00000040}\n"],encapsulation:2}),o})();var m=S(4719),r=(S(2504),S(537)),n=S(5195),l=S(398),c=S(4924),h=S(5870),y=S(6846),x=S(551),R=S(2734);function q(o,f){1&o&&e._UZ(0,"div",45)}function p(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Title is required"),e.qZA())}function L(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Price is required"),e.qZA())}function _(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Enter valid price"),e.qZA())}function ee(o,f){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const t=f.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Y(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Category is required"),e.qZA())}function u(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Vendor is required"),e.qZA())}function F(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Tag is required"),e.qZA())}function G(o,f){1&o&&(e.TgZ(0,"div",46),e._uU(1," Section is required"),e.qZA())}function k(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"label"),e._uU(2,"InSections"),e.qZA(),e.TgZ(3,"ngx-select",48),e.NdJ("data",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.value)}),e.qZA(),e.YNc(4,G,2,0,"div",15),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("multiple",!1)("items",t.inSectionItems)("disabled",t.disabled),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.inSection_id.hasError("required")&&(t.valForm.controls.inSection_id.dirty||t.valForm.controls.inSection_id.touched))}}function O(o,f){if(1&o&&(e.TgZ(0,"div",12)(1,"label"),e._uU(2,"Maximum Quantity"),e.qZA(),e._UZ(3,"input",49,50),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.maxQuantity)("pattern",t.pricePattern)}}function Q(o,f){if(1&o&&(e.TgZ(0,"span",51),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",null==t.selectedFile?null:t.selectedFile.name," ")}}function J(o,f){1&o&&e._UZ(0,"span",52)}function g(o,f){1&o&&e._UZ(0,"span",53)}let w=(()=>{class o{constructor(t,i,a,s,d,T,N,j,P,B){this.afs=i,this.router=a,this.productsService=s,this.validationService=d,this.categoryService=T,this.fireStorage=N,this.vendorsService=j,this.tagsService=P,this.imageCompress=B,this.vendorItems=[],this.tagItems=[],this.inSectionItems=[],this.value={},this.disabled=!1,this.loading=!1,this.saveLoading=!1,this.vendorData=[],this.pricePattern="^[1-9]d{0,7}(?:.d{1,4})?|.d{1,4}$",this.isQuantity=!1,this.maxQuantity=0,this.imgResultBeforeCompression="",this.imgResultAfterCompression="",this.imgResult="",this.valForm=t.group({name:["",m.kI.required],name_arabic:"",cat_id:["",m.kI.required],tag_id:["",m.kI.required],inSection_id:["",m.kI.required],vendor_id:["",m.kI.required],price:["",m.kI.required],image:"",description:"",description_arabic:"",isEnabled:[!0,m.kI.required],isQuantity:[!1,m.kI.required],max_quantity:""})}ngOnInit(){this.uid=sessionStorage.getItem("uid"),this.loginType=sessionStorage.getItem("loginType"),this.afs.collection("vendors",t=>t.where("uid","==",this.uid)).get().subscribe(t=>{t.forEach(i=>{this.vendorData=i.data(),this.vendor_id=i.id})}),this.categoryService.getCategoryList().subscribe(t=>{this.Categories=t.map(i=>{let a=i.payload.doc.data();return{id:i.payload.doc.id,...a}})}),$("#price").bind("cut copy paste",function(t){t.preventDefault()}),this.afs.collection("homeSections").snapshotChanges().subscribe(t=>{this.inSectionItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.inSectionItems.push(s)})}),this.tagsService.getTagsList().subscribe(t=>{this.tagItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.tagItems.push(s)})}),"u7GeGmO2luLmkOMKeZ0k"==this.loginType?this.afs.collection("vendors",t=>t.where("deleted_at","==",null).where("uid","==",this.uid)).snapshotChanges().subscribe(t=>{t.map(i=>{const a=i.payload.doc.id;this.afs.collection("shops",s=>s.where("deleted_at","==",null).where("vendor_id","==",a)).snapshotChanges().subscribe(s=>{this.vendorItems=[],s.map(d=>{let N={text:d.payload.doc.data().name,id:d.payload.doc.id};this.vendorItems.push(N)})})})}):this.vendorsService.getVendorsList().subscribe(t=>{this.vendorItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.vendorItems.push(s)})})}onChangeCategory(t){this.category_id=t}onIsQuantityChanged(t){1==t?(this.isQuantity=t,this.maxQuantity=1):(this.isQuantity=!1,this.maxQuantity=0)}onFileChanged(t,i){if(t&&"images"==i){if(this.selectedFile=t.target.files[0],0===this.selectedFile.length)return;const a=new FileReader;a.readAsDataURL(this.selectedFile),a.onload=s=>{this.fileUrl=a.result,this.smallFileUrl=a.result,this.uploadSmallFileToStorage(this.smallFileUrl),this.imageCompress.compressFile(this.smallFileUrl,30,30).then(d=>{this.imgResultAfterCompression=d,this.smallFileUrl=d,this.fileThumbnailUrl=d})}}}uploadSmallFileToStorage(t){this.loading=!0;const i=this.selectedFile,a=Date.now(),s="/products",T=this.fireStorage.ref(`${s}/${a}-${i.name}`);this.fireStorage.upload(`${s}/${a}-${i.name}`,i).snapshotChanges().pipe((0,r.x)(()=>{T.getDownloadURL().subscribe(P=>{P&&(this.smallFileStorageUrl=P,this.fileThumbnailUrl=P,console.log("this.smallFileStorageUrl..."+this.smallFileStorageUrl))})})).subscribe(j=>{j&&(this.loading=!1)})}addProduct(t,i){t.preventDefault();for(let a in this.valForm.controls)this.valForm.controls[a].markAsTouched();if(this.valForm.valid)if(this.selectedFile){this.loading=!0;const a=this.selectedFile,s=Date.now(),d="/products",N=this.fireStorage.ref(`${d}/${s}-${a.name}`);this.fireStorage.upload(`${d}/${s}-${a.name}`,a).snapshotChanges().pipe((0,r.x)(()=>{N.getDownloadURL().subscribe(B=>{if(B)if(this.fileUrl=B,this.selectedSmallFile){const se=this.selectedSmallFile,le=Date.now(),he="/products",Fe=this.fireStorage.ref(`${he}/${le}-${se.name}`);this.fireStorage.upload(`${he}/${le}-${se.name}`,se).snapshotChanges().pipe((0,r.x)(()=>{Fe.getDownloadURL().subscribe(Le=>{Le&&(this.smallFileUrl=Le,this.saveProductToDB(i))})})).subscribe(Ue=>{Ue&&(this.loading=!1)})}else this.saveProductToDB(i)})})).subscribe(P=>{P&&(this.loading=!1)})}else this.saveProductToDB(i)}saveProductToDB(t){this.saveLoading=!0;let i=t;(void 0===typeof i.name_arabic||null==i.name_arabic)&&(i.name_arabic=""),(void 0===typeof i.description_arabic||null==i.description_arabic)&&(i.description_arabic="");let a={name:i.name,name_arabic:i.name_arabic,cat_id:i.cat_id,tag_id:i.tag_id||[],inSection_id:[i.inSection_id],vendor_id:i.vendor_id||"",price:i.price,created_at:I.Z.firestore.FieldValue.serverTimestamp(),updated_at:I.Z.firestore.FieldValue.serverTimestamp(),created_by:this.uid,is_enabled:i.isEnabled,is_quantity:i.isQuantity,max_quantity:i.max_quantity||this.maxQuantity,description:null!=i.description?i.description:"",description_arabic:null!=i.description_arabic?i.description_arabic:"",image:this.fileUrl||"",smallImage:this.smallFileStorageUrl||"",previewImage:this.fileThumbnailUrl||"",deleted_at:null,deleted_by:null,disabled:!1,deleted_by_user_type:null};console.log("postData",a),this.productsService.addProdct(a).then(()=>{"u7GeGmO2luLmkOMKeZ0k"==this.loginType?this.vendorData.categories&&this.vendorData.categories.forEach(s=>{if(s.cat_id!=a.cat_id)if(Object.keys(this.vendorData.categories).length)if(s.productLimitation){var d;(d={})[`categories.${a.cat_id}`]=I.Z.firestore.FieldValue.increment(1),this.afs.collection("vendors").doc(this.vendor_id).update(d).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(1)}).then(T=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"])}).catch(T=>{this.loading=!1,this.saveLoading=!1})})}else this.saveLoading=!1,this.validationService.sweetalertError("Your product limitation in this category is fullfilled!");else this.saveLoading=!1,this.validationService.sweetalertError("Your category limitation is fullfilled!");else(d={})[`categories.${a.cat_id}`]=I.Z.firestore.FieldValue.increment(1),this.afs.collection("vendors").doc(this.vendor_id).update(d).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(1)}).then(N=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"])}).catch(N=>{this.loading=!1,this.saveLoading=!1})})}):this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(1)}).then(s=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"])}).catch(s=>{this.loading=!1,this.saveLoading=!1})}).catch(s=>{console.log(s),this.loading=!1,this.saveLoading=!1})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.QS),e.Y36(v.ST),e.Y36(X.F0),e.Y36(Te.s),e.Y36(ce.R),e.Y36(n.H),e.Y36(l.Q1),e.Y36(c.m),e.Y36(h.i),e.Y36(y.r))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-product-add"]],decls:94,vars:23,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-arrow-left","mr-1"],[1,"row"],[1,"col-md-12"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card","card-default"],[1,"card-body"],["role","form",1,"form-validate",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter"],["dataPost","ngForm"],[1,"form-row"],[1,"col-12","col-md-6"],[1,"mb-3"],["autocomplete","off","required","","formControlName","name","ngModel","","name","name","type","text","placeholder","Enter Product Title",1,"form-control","with-focus"],["class","text-danger",4,"ngIf"],["autocomplete","off","formControlName","name_arabic","ngModel","","name","name_arabic","type","text","placeholder","Enter Product Title",1,"form-control","with-focus"],["autocomplete","off","type","number","step","any","min","1","onpaste","return false","id","price","required","","formControlName","price","ngModel","","name","price","placeholder","Enter price",1,"form-control","with-focus",3,"pattern"],["price",""],["autocomplete","off","formControlName","description","name","description","type","text","placeholder","Enter description",1,"form-control"],["autocomplete","off","formControlName","description_arabic","name","description_arabic","type","text","placeholder","Enter description",1,"form-control"],["required","","formControlName","cat_id","ngModel","","name","category",1,"custom-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-md-12"],["required","","ngModel","","formControlName","vendor_id","name","vendor_id","optionValueField","id","optionTextField","text","placeholder","Select vendors",1,"custom-single-select",3,"multiple","items","disabled","data"],["required","","ngModel","","formControlName","tag_id","name","tag_id","optionValueField","id","optionTextField","text","placeholder","Select tags",3,"multiple","items","disabled","data"],["class","mb-3",4,"ngIf"],[1,"col-12"],[1,"row","mb-3"],[1,"col-12","col-md-3"],["formControlName","isEnabled"],["formControlName","isQuantity","id","isQuantity",3,"change"],["class","col-12 col-md-6",4,"ngIf"],["for","image-input",1,"file-upload"],[1,"btn","btn-secondary"],[1,"far","fa-folder-open","mr"],["ngModel","","placeholder","Choose image","type","file","formControlName","image","name","image","accept",".jpeg,.jpg,.png,.svg",1,"form-control",3,"input"],["class","form-control",4,"ngIf"],[1,"image-preview-box"],["onerror","this.onerror=null;this.src='assets/img/preview-img.png';",1,"previewImage",3,"src"],["class","spinner-border spinner-border-sm custom-spinner",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],["type","submit",1,"btn","btn-sm","btn-info"],["class","spinner-border spinner-border-sm ml-2",4,"ngIf"],["role","status",1,"spinner-border","loading"],[1,"text-danger"],[3,"value"],["ngModel","","required","","formControlName","inSection_id","name","inSection","optionValueField","id","optionTextField","text","placeholder","Select inSection",1,"custom-single-select",3,"multiple","items","disabled","data"],["autocomplete","off","type","number","step","any","min","1","onpaste","return false","id","max_quantity","formControlName","max_quantity","name","max_quantity","placeholder","Enter max quantity",1,"form-control","with-focus",3,"ngModel","pattern"],["max_quantity",""],[1,"form-control"],[1,"spinner-border","spinner-border-sm","custom-spinner"],[1,"spinner-border","spinner-border-sm","ml-2"]],template:function(t,i){if(1&t){const a=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Add Product"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Back "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5),e.YNc(9,q,1,0,"div",6),e.TgZ(10,"div",7)(11,"div",8)(12,"form",9,10),e.NdJ("ngSubmit",function(d){e.CHM(a);const T=e.MAs(13);return e.KtG(i.addProduct(d,T.value))})("keydown.enter",function(d){return d.preventDefault()})("keydown.shift.enter",function(d){return d.preventDefault()}),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"label"),e._uU(18,"Product Title (ENGLISH)"),e.qZA(),e._UZ(19,"input",14),e.YNc(20,p,2,0,"div",15),e.qZA(),e.TgZ(21,"div",13)(22,"label"),e._uU(23,"Product Title (ARABIC)"),e.qZA(),e._UZ(24,"input",16),e.qZA(),e.TgZ(25,"div",13)(26,"label"),e._uU(27,"Price"),e.qZA(),e._UZ(28,"input",17,18),e.YNc(30,L,2,0,"div",15),e.YNc(31,_,2,0,"div",15),e.qZA(),e.TgZ(32,"div",13)(33,"label"),e._uU(34,"Description (ENGLISH)"),e.qZA(),e._UZ(35,"textarea",19),e.qZA(),e.TgZ(36,"div",13)(37,"label"),e._uU(38,"Description (ARABIC)"),e.qZA(),e._UZ(39,"textarea",20),e.qZA(),e.TgZ(40,"div",13)(41,"label"),e._uU(42,"Category"),e.qZA(),e.TgZ(43,"select",21),e.NdJ("change",function(d){return i.onChangeCategory(d.target.value)}),e.TgZ(44,"option",22),e._uU(45,"Select Category"),e.qZA(),e.YNc(46,ee,2,2,"option",23),e.qZA(),e.YNc(47,Y,2,0,"div",15),e.qZA()(),e.TgZ(48,"div",12)(49,"div",11)(50,"div",24)(51,"label"),e._uU(52,"Vendor"),e.qZA(),e.TgZ(53,"ngx-select",25),e.NdJ("data",function(){return i.value}),e.qZA(),e.YNc(54,u,2,0,"div",15),e.qZA(),e._UZ(55,"div",24),e.TgZ(56,"div",24)(57,"div",13)(58,"label"),e._uU(59,"Tags"),e.qZA(),e.TgZ(60,"ngx-select",26),e.NdJ("data",function(){return i.value}),e.qZA(),e.YNc(61,F,2,0,"div",15),e.qZA()(),e._UZ(62,"div",24),e.TgZ(63,"div",24),e.YNc(64,k,5,4,"div",27),e.qZA(),e.TgZ(65,"div",28)(66,"div",29)(67,"div",30)(68,"label"),e._uU(69,"Active"),e.qZA(),e._UZ(70,"ui-switch",31),e.qZA(),e.TgZ(71,"div",30)(72,"label"),e._uU(73,"isQuantity"),e.qZA(),e.TgZ(74,"ui-switch",32),e.NdJ("change",function(d){return i.onIsQuantityChanged(d)}),e.qZA()(),e.YNc(75,O,5,2,"div",33),e.qZA()(),e.TgZ(76,"div",24)(77,"div",13)(78,"label"),e._uU(79,"Choose Image"),e.qZA(),e.TgZ(80,"label",34)(81,"button",35),e._uU(82," Select Image "),e._UZ(83,"em",36),e.qZA(),e.TgZ(84,"input",37),e.NdJ("input",function(d){return i.onFileChanged(d,"images")}),e.qZA(),e.YNc(85,Q,2,1,"span",38),e.qZA(),e.TgZ(86,"div",39),e._UZ(87,"img",40),e.YNc(88,J,1,0,"span",41),e.qZA()()()()()(),e.TgZ(89,"button",42),e.NdJ("click",function(){e.CHM(a);const d=e.MAs(13);return e.KtG(d.resetForm({}))}),e._uU(90,"Clear"),e.qZA(),e.TgZ(91,"button",43),e._uU(92,"Save "),e.YNc(93,g,1,0,"span",44),e.qZA()()()()()()}2&t&&(e.xp6(4),e.Q6J("routerLink","/products"),e.xp6(5),e.Q6J("ngIf",i.loading),e.xp6(3),e.Q6J("formGroup",i.valForm),e.xp6(8),e.Q6J("ngIf",i.valForm.controls.name.hasError("required")&&(i.valForm.controls.name.dirty||i.valForm.controls.name.touched)),e.xp6(8),e.Q6J("pattern",i.pricePattern),e.xp6(2),e.Q6J("ngIf",i.valForm.controls.price.hasError("required")&&(i.valForm.controls.price.dirty||i.valForm.controls.price.touched)),e.xp6(1),e.Q6J("ngIf",i.valForm.controls.price.hasError("pattern")),e.xp6(15),e.Q6J("ngForOf",i.Categories),e.xp6(1),e.Q6J("ngIf",i.valForm.controls.cat_id.hasError("required")&&(i.valForm.controls.cat_id.dirty||i.valForm.controls.cat_id.touched)),e.xp6(6),e.Q6J("multiple",!1)("items",i.vendorItems)("disabled",i.disabled),e.xp6(1),e.Q6J("ngIf",i.valForm.controls.vendor_id.hasError("required")&&(i.valForm.controls.vendor_id.dirty||i.valForm.controls.vendor_id.touched)),e.xp6(6),e.Q6J("multiple",!0)("items",i.tagItems)("disabled",i.disabled),e.xp6(1),e.Q6J("ngIf",i.valForm.controls.tag_id.hasError("required")&&(i.valForm.controls.tag_id.dirty||i.valForm.controls.tag_id.touched)),e.xp6(3),e.Q6J("ngIf","u7GeGmO2luLmkOMKeZ0k"!=i.loginType),e.xp6(11),e.Q6J("ngIf",i.isQuantity),e.xp6(10),e.Q6J("ngIf",null==i.selectedFile?null:i.selectedFile.name),e.xp6(2),e.Q6J("src",i.fileUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",i.loading),e.xp6(5),e.Q6J("ngIf",i.saveLoading))},dependencies:[de.sg,de.O5,m._Y,m.YN,m.Kr,m.Fj,m.wV,m.EJ,m.JJ,m.JL,m.Q7,m.c5,m.qQ,m.sg,m.u,X.rH,x.O2,R.ob]}),o})();var E=S(9365);function M(o,f){1&o&&(e.TgZ(0,"div",11),e._UZ(1,"span",12),e.qZA())}function C(o,f){1&o&&e._UZ(0,"div",13)}function Z(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," Title is required"),e.qZA())}function U(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," Price is required"),e.qZA())}function b(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," Enter valid price"),e.qZA())}function re(o,f){if(1&o&&(e.TgZ(0,"option",52),e._uU(1),e.qZA()),2&o){const t=f.$implicit;e.s9C("value",t.id),e.xp6(1),e.Oqu(t.name)}}function W(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," Category is required"),e.qZA())}function z(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," Vendor is required"),e.qZA())}function ae(o,f){1&o&&(e.TgZ(0,"div",51),e._uU(1," tag is required"),e.qZA())}function te(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"label"),e._uU(2,"InSections"),e.qZA(),e.TgZ(3,"ngx-select",53),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw(2);return e.KtG(s.productDetailData.inSection_id=a)})("data",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.value)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.productDetailData.inSection_id)("multiple",!0)("items",t.inSectionItems)("disabled",t.disabled)}}function V(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"div",54)(1,"label"),e._uU(2,"Maximum Quantity"),e.qZA(),e.TgZ(3,"input",55,56),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw(2);return e.KtG(s.productDetailData.max_quantity=a)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.productDetailData.max_quantity)("pattern",t.pricePattern)}}function H(o,f){if(1&o&&(e.TgZ(0,"span",57),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" ",null==t.selectedFile?null:t.selectedFile.name," ")}}function oe(o,f){if(1&o&&(e.TgZ(0,"span",57),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.fileName," ")}}function K(o,f){1&o&&e._UZ(0,"span",58)}function ue(o,f){1&o&&e._UZ(0,"span",59)}function ne(o,f){if(1&o){const t=e.EpF();e.TgZ(0,"form",14,15),e.NdJ("ngSubmit",function(a){e.CHM(t);const s=e.MAs(1),d=e.oxw();return e.KtG(d.editProduct(a,s.value))})("keydown.enter",function(a){return a.preventDefault()})("keydown.shift.enter",function(a){return a.preventDefault()}),e.TgZ(2,"div",16)(3,"div",17)(4,"div",18)(5,"label"),e._uU(6,"Product Title (ENGLISH)"),e.qZA(),e.TgZ(7,"input",19),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.name=a)}),e.qZA(),e.YNc(8,Z,2,0,"div",20),e.qZA(),e.TgZ(9,"div",18)(10,"label"),e._uU(11,"Product Title (ARABIC)"),e.qZA(),e.TgZ(12,"input",21),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.name_arabic=a)}),e.qZA()(),e.TgZ(13,"div",18)(14,"label"),e._uU(15,"Price"),e.qZA(),e.TgZ(16,"input",22,23),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.price=a)}),e.qZA(),e.YNc(18,U,2,0,"div",20),e.YNc(19,b,2,0,"div",20),e.qZA(),e.TgZ(20,"div",18)(21,"label"),e._uU(22,"Description (ENGLISH)"),e.qZA(),e.TgZ(23,"textarea",24),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.description=a)}),e.qZA()(),e.TgZ(24,"div",18)(25,"label"),e._uU(26,"Description (ARABIC)"),e.qZA(),e.TgZ(27,"textarea",25),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.description_arabic=a)}),e.qZA()(),e.TgZ(28,"div",18)(29,"label"),e._uU(30,"Category"),e.qZA(),e.TgZ(31,"select",26),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.cat_id=a)})("change",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.onChangeCategory(a.target.value))}),e.TgZ(32,"option",27),e._uU(33,"select Category"),e.qZA(),e.YNc(34,re,2,2,"option",28),e.qZA(),e.YNc(35,W,2,0,"div",20),e.qZA()(),e.TgZ(36,"div",17)(37,"div",16)(38,"div",29)(39,"div",18)(40,"label",30),e._uU(41,"Vendor"),e.qZA(),e.TgZ(42,"ngx-select",31),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.vendor_id=a)})("data",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.value)}),e.qZA(),e.YNc(43,z,2,0,"div",20),e.qZA()(),e.TgZ(44,"div",29)(45,"div",18)(46,"label"),e._uU(47,"Tags"),e.qZA(),e.TgZ(48,"ngx-select",32),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.tag_id=a)})("data",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.value)}),e.qZA(),e.YNc(49,ae,2,0,"div",20),e.qZA()(),e._UZ(50,"div",29),e.TgZ(51,"div",29),e.YNc(52,te,4,4,"div",33),e.qZA(),e.TgZ(53,"div",34)(54,"div",35)(55,"div",36)(56,"label"),e._uU(57,"Active"),e.qZA(),e.TgZ(58,"ui-switch",37),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.productDetailData.is_enabled=a)}),e.qZA()(),e.TgZ(59,"div",36)(60,"label"),e._uU(61,"isQuantity"),e.qZA(),e.TgZ(62,"ui-switch",38),e.NdJ("change",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.onIsQuantityChanged(a))}),e.qZA()(),e.YNc(63,V,5,2,"div",39),e.qZA()(),e.TgZ(64,"div",29)(65,"div",18)(66,"label"),e._uU(67,"Choose Image"),e.qZA(),e.TgZ(68,"label",40)(69,"button",41),e._uU(70," Select Image "),e._UZ(71,"em",42),e.qZA(),e.TgZ(72,"input",43),e.NdJ("input",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.onFileChanged(a,"images"))}),e.qZA(),e.YNc(73,H,2,1,"span",44),e.YNc(74,oe,2,1,"span",44),e.qZA(),e.TgZ(75,"div",45),e._UZ(76,"img",46),e.YNc(77,K,1,0,"span",47),e.qZA()()()()()(),e.TgZ(78,"button",48),e.NdJ("click",function(){e.CHM(t);const a=e.MAs(1);return e.KtG(a.resetForm({}))}),e._uU(79,"Clear"),e.qZA(),e.TgZ(80,"button",49),e._uU(81,"Save"),e.YNc(82,ue,1,0,"span",50),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("formGroup",t.valForm),e.xp6(7),e.Q6J("ngModel",t.productDetailData.name),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.name.hasError("required")&&(t.valForm.controls.name.dirty||t.valForm.controls.name.touched)),e.xp6(4),e.Q6J("ngModel",t.productDetailData.name_arabic),e.xp6(4),e.Q6J("pattern",t.pricePattern)("ngModel",t.productDetailData.price),e.xp6(2),e.Q6J("ngIf",t.valForm.controls.price.hasError("required")&&(t.valForm.controls.price.dirty||t.valForm.controls.price.touched)),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.price.hasError("pattern")),e.xp6(4),e.Q6J("ngModel",t.productDetailData.description),e.xp6(4),e.Q6J("ngModel",t.productDetailData.description_arabic),e.xp6(4),e.Q6J("ngModel",t.productDetailData.cat_id),e.xp6(3),e.Q6J("ngForOf",t.Categories),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.cat_id.hasError("required")&&(t.valForm.controls.cat_id.dirty||t.valForm.controls.cat_id.touched)),e.xp6(7),e.Q6J("ngModel",t.productDetailData.vendor_id)("multiple",!1)("items",t.vendorItems)("disabled",t.disabled),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.vendor_id.hasError("required")&&(t.valForm.controls.vendor_id.dirty||t.valForm.controls.vendor_id.touched)),e.xp6(5),e.Q6J("ngModel",t.productDetailData.tag_id)("multiple",!0)("items",t.tagItems)("disabled",t.disabled),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.tag_id.hasError("required")&&(t.valForm.controls.tag_id.dirty||t.valForm.controls.tag_id.touched)),e.xp6(3),e.Q6J("ngIf","u7GeGmO2luLmkOMKeZ0k"!=t.loginType),e.xp6(6),e.Q6J("ngModel",t.productDetailData.is_enabled),e.xp6(5),e.Q6J("ngIf",t.isQuantity),e.xp6(10),e.Q6J("ngIf",null==t.selectedFile?null:t.selectedFile.name),e.xp6(1),e.Q6J("ngIf",!(null!=t.selectedFile&&t.selectedFile.name)),e.xp6(2),e.Q6J("src",t.fileUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",t.imageFileloading),e.xp6(5),e.Q6J("ngIf",t.saveLoading)}}const ge=[{path:"",component:ye},{path:"products",component:ye},{path:"add",component:w},{path:"edit/:id",component:(()=>{class o{constructor(t,i,a,s,d,T,N,j,P,B,se,le){this.afs=i,this.router=a,this.route=s,this.productsService=d,this.validationService=T,this.categoryService=N,this.fireStorage=j,this.shopsService=P,this.tagsService=B,this.vendorService=se,this.imageCompress=le,this.vendorItems=[],this.inSectionItems=[],this.tagItems=[],this.value={},this.disabled=!1,this.loading=!1,this.productDetailData=[],this.saveLoading=!1,this.imageFileloading=!1,this.vendorData=[],this.fullPageLoader=!1,this.pricePattern="^[1-9]d{0,7}(?:.d{1,4})?|.d{1,4}$",this.isQuantity=!1,this.maxQuantity=0,this.imgResultBeforeCompression="",this.imgResultAfterCompression="",this.imgResult="",this.valForm=t.group({name:["",m.kI.required],name_arabic:"",cat_id:["",m.kI.required],tag_id:["",m.kI.required],inSection_id:"",vendor_id:["",m.kI.required],price:["",m.kI.required],image:"",description:[""],description_arabic:"",isEnabled:[!0,m.kI.required],isQuantity:[!1,m.kI.required],max_quantity:""})}ngOnInit(){this.uid=sessionStorage.getItem("uid"),this.id=this.route.snapshot.params.id,this.fullPageLoader=!0,this.loginType=sessionStorage.getItem("loginType"),this.afs.collection("vendors",t=>t.where("uid","==",this.uid)).get().subscribe(t=>{t.forEach(i=>{this.vendorData=i.data(),this.vendor_id=i.id})}),this.productsService.getProductDetail(this.id).get().subscribe(t=>{t.exists?(this.productDetailData=t.data(),this.cat_id=this.productDetailData.cat_id,this.productDetailData.image&&(this.fileName=this.productDetailData.image,this.fileUrl=this.productDetailData.image,this.selectedFile=this.fileUrl),this.productDetailData.smallImage&&(this.smallFileUrl=this.productDetailData.smallImage),this.productDetailData.previewImage&&(this.fileThumbnailUrl=this.productDetailData.previewImage),this.fullPageLoader=!1):this.fullPageLoader=!1}),$("#price").bind("cut copy paste",function(t){t.preventDefault()}),this.categoryService.getCategoryList().subscribe(t=>{this.Categories=t.map(i=>{let a=i.payload.doc.data();return{id:i.payload.doc.id,...a}})}),this.afs.collection("homeSections").snapshotChanges().subscribe(t=>{this.inSectionItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.inSectionItems.push(s)})}),this.tagsService.getTagsList().subscribe(t=>{this.tagItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.tagItems.push(s)})}),this.vendorService.getVendorsList().subscribe(t=>{this.vendorItems=[],t.map(i=>{let s={text:i.payload.doc.data().name,id:i.payload.doc.id};this.vendorItems.push(s)}),console.log("this.vendorItems..."+this.vendorItems)})}onChangeCategory(t){this.category_id=t}onIsQuantityChanged(t){1==t?(this.isQuantity=t,this.maxQuantity=1):(this.isQuantity=!1,this.maxQuantity=0)}onFileChanged(t,i){if(t&&"images"==i){if(this.selectedFile=t.target.files[0],0===this.selectedFile.length)return;const a=new FileReader;a.readAsDataURL(this.selectedFile),a.onload=s=>{this.fileUrl=a.result,this.smallFileUrl=a.result,this.imageCompress.compressFile(this.smallFileUrl,30,30).then(d=>{this.imgResultAfterCompression=d,this.smallFileUrl=d})}}}editProduct(t,i){this.loading=!0,t.preventDefault();for(let a in this.valForm.controls)this.valForm.controls[a].markAsTouched();if(this.valForm.valid&&this.selectedFile){const a=this.selectedFile,s=Date.now(),d="/products",N=this.fireStorage.ref(`${d}/${s}-${a.name}`);if(this.fireStorage.upload(`${d}/${s}-${a.name}`,a).snapshotChanges().pipe((0,r.x)(()=>{N.getDownloadURL().subscribe(B=>{B&&(this.fileUrl=B,this.loading=!1)})})).subscribe(P=>{P&&(this.loading=!1)}),this.selectedSmallFile){const P=this.selectedSmallFile,B=Date.now(),se="/products",he=this.fireStorage.ref(`${se}/${B}-${P.name}`);this.fireStorage.upload(`${se}/${B}-${P.name}`,P).snapshotChanges().pipe((0,r.x)(()=>{he.getDownloadURL().subscribe(Ie=>{Ie&&(this.smallFileUrl=Ie)})})).subscribe(Fe=>{Fe&&(this.loading=!1)})}this.saveProductToDB(i)}else this.valForm.valid&&(this.saveProductToDB(i),this.loading=!1)}saveProductToDB(t){this.saveLoading=!0;let i=t;("string"==typeof i.inSection_id||null==i.inSection_id)&&(i.inSection_id=[]),(void 0===typeof i.name_arabic||null==i.name_arabic)&&(i.name_arabic=""),(void 0===typeof i.description_arabic||null==i.description_arabic)&&(i.description_arabic="");let a={name:i.name,name_arabic:null!=i.name_arabic?i.name_arabic:"",cat_id:i.cat_id,tag_id:i.tag_id||[],inSection_id:i.inSection_id,vendor_id:i.vendor_id||"",price:i.price,max_quantity:i.max_quantity||this.maxQuantity,created_at:I.Z.firestore.FieldValue.serverTimestamp(),updated_at:I.Z.firestore.FieldValue.serverTimestamp(),is_enabled:i.isEnabled,description:null!=i.description?i.description:"",description_arabic:null!=i.description_arabic?i.description_arabic:"",image:this.fileUrl||"",smallImage:this.smallFileUrl||"",previewImage:this.fileThumbnailUrl||""};console.log("postData",a),this.productsService.updateProduct(this.id,a).then(()=>{"u7GeGmO2luLmkOMKeZ0k"==this.loginType?this.vendorData.categories&&this.vendorData.categories.forEach(s=>{if(s.cat_id!=a.cat_id)if(Object.keys(this.vendorData.categories).length)if(s.productLimitation){var d={};d[`categories.${this.cat_id}`]=I.Z.firestore.FieldValue.increment(-1),d[`categories.${a.cat_id}`]=I.Z.firestore.FieldValue.increment(1),this.afs.collection("vendors").doc(this.vendor_id).update(d).then(()=>{this.afs.collection("settings").doc("counts").update({"counts.products":I.Z.firestore.FieldValue.increment(1)}).then(T=>{this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"])}).catch(T=>{this.loading=!1,this.saveLoading=!1})})}else this.saveLoading=!1,this.validationService.sweetalertError("Your product limitation in this category is fullfilled!");else this.saveLoading=!1,this.validationService.sweetalertError("Your category limitation is fullfilled!");else this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"])}):(this.loading=!1,this.saveLoading=!1,this.validationService.sweetalertSuccess(),this.router.navigate(["/products"]))}).catch(s=>{console.log(s),this.loading=!1,this.saveLoading=!1})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.QS),e.Y36(v.ST),e.Y36(X.F0),e.Y36(X.gz),e.Y36(Te.s),e.Y36(ce.R),e.Y36(n.H),e.Y36(l.Q1),e.Y36(E.n),e.Y36(h.i),e.Y36(c.m),e.Y36(y.r))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-product-edit"]],decls:14,vars:4,consts:[["class","fullLoaderBg",4,"ngIf"],[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-arrow-left","mr-1"],[1,"row"],[1,"col-md-12"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card","card-default"],[1,"card-body"],["class","form-validate","role","form",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter",4,"ngIf"],[1,"fullLoaderBg"],[1,"spinner-border","spinner-border-lg","fullLoader"],["role","status",1,"spinner-border","loading"],["role","form",1,"form-validate",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter"],["dataPost","ngForm"],[1,"form-row"],[1,"col-6"],[1,"mb-3"],["autocomplete","off","required","","formControlName","name","name","name","type","text","placeholder","Enter Product Title",1,"form-control","with-focus",3,"ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],["autocomplete","off","formControlName","name_arabic","name","name_arabic","type","text","placeholder","Enter Product Title",1,"form-control","with-focus",3,"ngModel","ngModelChange"],["autocomplete","off","type","number","step","any","min","1","onpaste","return false","id","price","required","","formControlName","price","name","price","placeholder","Enter price",1,"form-control","with-focus",3,"pattern","ngModel","ngModelChange"],["price",""],["autocomplete","off","formControlName","description","name","description","type","text","placeholder","Enter description",1,"form-control",3,"ngModel","ngModelChange"],["autocomplete","off","formControlName","description_arabic","name","description_arabic","type","text","placeholder","Enter description",1,"form-control",3,"ngModel","ngModelChange"],["required","","formControlName","cat_id","name","category",1,"custom-select",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-md-12"],[1,"mt"],["required","","formControlName","vendor_id","name","vendor_id","optionValueField","id","optionTextField","text","placeholder","Select vendor",1,"custom-single-select",3,"ngModel","multiple","items","disabled","ngModelChange","data"],["required","","formControlName","tag_id","name","tag_id","optionValueField","id","optionTextField","text","placeholder","Select tags",3,"ngModel","multiple","items","disabled","ngModelChange","data"],["class","mb-3",4,"ngIf"],[1,"col-12"],[1,"row","mb-3"],[1,"col-12","col-md-3"],["formControlName","isEnabled",3,"ngModel","ngModelChange"],["formControlName","isQuantity","id","isQuantity",3,"change"],["class","col-12 col-md-6",4,"ngIf"],["for","image-input",1,"file-upload"],[1,"btn","btn-secondary"],[1,"far","fa-folder-open","mr"],["ngModel","","placeholder","Choose image","type","file","formControlName","image","name","image","accept",".jpeg,.jpg,.png,.svg",1,"form-control",3,"input"],["class","form-control",4,"ngIf"],[1,"image-preview-box"],["onerror","this.onerror=null;this.src='assets/img/preview-img.png';",1,"previewImage",3,"src"],["class","spinner-border spinner-border-sm custom-spinner",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],["type","submit",1,"btn","btn-sm","btn-info"],["class","spinner-border spinner-border-sm ml-2",4,"ngIf"],[1,"text-danger"],[3,"value"],["ngModel","","formControlName","inSection_id","name","inSection","optionValueField","id","optionTextField","text","placeholder","Select inSection",3,"ngModel","multiple","items","disabled","ngModelChange","data"],[1,"col-12","col-md-6"],["autocomplete","off","type","number","step","any","min","1","onpaste","return false","id","max_quantity","required","","formControlName","max_quantity","name","max_quantity","placeholder","Enter max quantity",1,"form-control","with-focus",3,"ngModel","pattern","ngModelChange"],["max_quantity",""],[1,"form-control"],[1,"spinner-border","spinner-border-sm","custom-spinner"],[1,"spinner-border","spinner-border-sm","ml-2"]],template:function(t,i){1&t&&(e.YNc(0,M,2,0,"div",0),e.TgZ(1,"div",1)(2,"div",2)(3,"span"),e._uU(4,"Edit Product"),e.qZA(),e.TgZ(5,"button",3),e._UZ(6,"em",4),e._uU(7," Back "),e.qZA()()(),e.TgZ(8,"div",5)(9,"div",6),e.YNc(10,C,1,0,"div",7),e.TgZ(11,"div",8)(12,"div",9),e.YNc(13,ne,83,31,"form",10),e.qZA()()()()),2&t&&(e.Q6J("ngIf",i.fullPageLoader),e.xp6(5),e.Q6J("routerLink","/products"),e.xp6(5),e.Q6J("ngIf",i.loading),e.xp6(3),e.Q6J("ngIf",i.productDetailData))},dependencies:[de.sg,de.O5,m._Y,m.YN,m.Kr,m.Fj,m.wV,m.EJ,m.JJ,m.JL,m.Q7,m.c5,m.qQ,m.sg,m.u,X.rH,x.O2,R.ob]}),o})()}];let Ce=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[y.r],imports:[we.m,D.xD,x.i4,de.ez,R.Su,X.Bz.forChild(ge),X.Bz]}),o})()},3028:function(qe,Ze){var S,X;S=function we(){"use strict";var D=typeof self<"u"?self:typeof window<"u"?window:void 0!==D?D:{},I=!D.document&&!!D.postMessage,Se=I&&/blob:/i.test((D.location||{}).protocol),e={},Te=0,v={parse:function(r,n){var l=(n=n||{}).dynamicTyping||!1;if(A(l)&&(n.dynamicTypingFunction=l,l={}),n.dynamicTyping=l,n.transform=!!A(n.transform)&&n.transform,n.worker&&v.WORKERS_SUPPORTED){var c=function(){if(!v.WORKERS_SUPPORTED)return!1;var R,q,y=(R=D.URL||D.webkitURL||null,q=we.toString(),v.BLOB_URL||(v.BLOB_URL=R.createObjectURL(new Blob(["(",q,")();"],{type:"text/javascript"})))),x=new D.Worker(y);return x.onmessage=Ee,x.id=Te++,e[x.id]=x}();return c.userStep=n.step,c.userChunk=n.chunk,c.userComplete=n.complete,c.userError=n.error,n.step=A(n.step),n.chunk=A(n.chunk),n.complete=A(n.complete),n.error=A(n.error),delete n.worker,void c.postMessage({input:r,config:n,workerId:c.id})}var h=null;return"string"==typeof r?h=n.download?new ce(n):new fe(n):!0===r.readable&&A(r.read)&&A(r.on)?h=new ve(n):(D.File&&r instanceof File||r instanceof Object)&&(h=new _e(n)),h.stream(r)},unparse:function(r,n){var l=!1,c=!0,h=",",y="\r\n",x='"',R=x+x,q=!1,p=null,L=!1;!function(){if("object"==typeof n){if("string"!=typeof n.delimiter||v.BAD_DELIMITERS.filter(function(u){return-1!==n.delimiter.indexOf(u)}).length||(h=n.delimiter),("boolean"==typeof n.quotes||"function"==typeof n.quotes||Array.isArray(n.quotes))&&(l=n.quotes),"boolean"!=typeof n.skipEmptyLines&&"string"!=typeof n.skipEmptyLines||(q=n.skipEmptyLines),"string"==typeof n.newline&&(y=n.newline),"string"==typeof n.quoteChar&&(x=n.quoteChar),"boolean"==typeof n.header&&(c=n.header),Array.isArray(n.columns)){if(0===n.columns.length)throw new Error("Option columns is empty");p=n.columns}void 0!==n.escapeChar&&(R=n.escapeChar+x),("boolean"==typeof n.escapeFormulae||n.escapeFormulae instanceof RegExp)&&(L=n.escapeFormulae instanceof RegExp?n.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var _=new RegExp(me(x),"g");if("string"==typeof r&&(r=JSON.parse(r)),Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return ee(null,r,q);if("object"==typeof r[0])return ee(p||Object.keys(r[0]),r,q)}else if("object"==typeof r)return"string"==typeof r.data&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields||p),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:"object"==typeof r.data[0]?Object.keys(r.data[0]):[]),Array.isArray(r.data[0])||"object"==typeof r.data[0]||(r.data=[r.data])),ee(r.fields||[],r.data||[],q);throw new Error("Unable to serialize unrecognized input");function ee(u,F,G){var k="";"string"==typeof u&&(u=JSON.parse(u)),"string"==typeof F&&(F=JSON.parse(F));var O=Array.isArray(u)&&0<u.length,Q=!Array.isArray(F[0]);if(O&&c){for(var J=0;J<u.length;J++)0<J&&(k+=h),k+=Y(u[J],J);0<F.length&&(k+=y)}for(var g=0;g<F.length;g++){var w=O?u.length:F[g].length,E=!1,M=O?0===Object.keys(F[g]).length:0===F[g].length;if(G&&!O&&(E="greedy"===G?""===F[g].join("").trim():1===F[g].length&&0===F[g][0].length),"greedy"===G&&O){for(var C=[],Z=0;Z<w;Z++)C.push(F[g][Q?u[Z]:Z]);E=""===C.join("").trim()}if(!E){for(var b=0;b<w;b++)0<b&&!M&&(k+=h),k+=Y(F[g][O&&Q?u[b]:b],b);g<F.length-1&&(!G||0<w&&!M)&&(k+=y)}}return k}function Y(u,F){if(null==u)return"";if(u.constructor===Date)return JSON.stringify(u).slice(1,25);var G=!1;L&&"string"==typeof u&&L.test(u)&&(u="'"+u,G=!0);var k=u.toString().replace(_,R);return(G=G||!0===l||"function"==typeof l&&l(u,F)||Array.isArray(l)&&l[F]||function(O,Q){for(var J=0;J<Q.length;J++)if(-1<O.indexOf(Q[J]))return!0;return!1}(k,v.BAD_DELIMITERS)||-1<k.indexOf(h)||" "===k.charAt(0)||" "===k.charAt(k.length-1))?x+k+x:k}}};if(v.RECORD_SEP=String.fromCharCode(30),v.UNIT_SEP=String.fromCharCode(31),v.BYTE_ORDER_MARK="\ufeff",v.BAD_DELIMITERS=["\r","\n",'"',v.BYTE_ORDER_MARK],v.WORKERS_SUPPORTED=!I&&!!D.Worker,v.NODE_STREAM_INPUT=1,v.LocalChunkSize=10485760,v.RemoteChunkSize=5242880,v.DefaultDelimiter=",",v.Parser=xe,v.ParserHandle=De,v.NetworkStreamer=ce,v.FileStreamer=_e,v.StringStreamer=fe,v.ReadableStreamStreamer=ve,D.jQuery){var pe=D.jQuery;pe.fn.parse=function(r){var n=r.config||{},l=[];return this.each(function(y){if("INPUT"!==pe(this).prop("tagName").toUpperCase()||"file"!==pe(this).attr("type").toLowerCase()||!D.FileReader||!this.files||0===this.files.length)return!0;for(var x=0;x<this.files.length;x++)l.push({file:this.files[x],inputElem:this,instanceConfig:pe.extend({},n)})}),c(),this;function c(){if(0!==l.length){var x,R,q,p=l[0];if(A(r.before)){var L=r.before(p.file,p.inputElem);if("object"==typeof L){if("abort"===L.action)return"AbortError",x=p.file,R=p.inputElem,q=L.reason,void(A(r.error)&&r.error({name:"AbortError"},x,R,q));if("skip"===L.action)return void h();"object"==typeof L.config&&(p.instanceConfig=pe.extend(p.instanceConfig,L.config))}else if("skip"===L)return void h()}var _=p.instanceConfig.complete;p.instanceConfig.complete=function(ee){A(_)&&_(ee,p.file,p.inputElem),h()},v.parse(p.file,p.instanceConfig)}else A(r.complete)&&r.complete()}function h(){l.splice(0,1),c()}}}function ie(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(n){var l=ye(n);l.chunkSize=parseInt(l.chunkSize),n.step||n.chunk||(l.chunkSize=null),this._handle=new De(l),(this._handle.streamer=this)._config=l}.call(this,r),this.parseChunk=function(n,l){if(this.isFirstChunk&&A(this._config.beforeFirstChunk)){var c=this._config.beforeFirstChunk(n);void 0!==c&&(n=c)}this.isFirstChunk=!1,this._halted=!1;var h=this._partialLine+n;this._partialLine="";var y=this._handle.parse(h,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var x=y.meta.cursor;this._finished||(this._partialLine=h.substring(x-this._baseIndex),this._baseIndex=x),y&&y.data&&(this._rowCount+=y.data.length);var R=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(Se)D.postMessage({results:y,workerId:v.WORKER_ID,finished:R});else if(A(this._config.chunk)&&!l){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);y=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!R||!A(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),R||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(n){A(this._config.error)?this._config.error(n):Se&&this._config.error&&D.postMessage({workerId:v.WORKER_ID,error:n,finished:!1})}}function ce(r){var n;(r=r||{}).chunkSize||(r.chunkSize=v.RemoteChunkSize),ie.call(this,r),this._nextChunk=I?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(l){this._input=l,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(n=new XMLHttpRequest,this._config.withCredentials&&(n.withCredentials=this._config.withCredentials),I||(n.onload=m(this._chunkLoaded,this),n.onerror=m(this._chunkError,this)),n.open(this._config.downloadRequestBody?"POST":"GET",this._input,!I),this._config.downloadRequestHeaders){var l=this._config.downloadRequestHeaders;for(var c in l)n.setRequestHeader(c,l[c])}this._config.chunkSize&&n.setRequestHeader("Range","bytes="+this._start+"-"+(this._start+this._config.chunkSize-1));try{n.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}I&&0===n.status&&this._chunkError()}},this._chunkLoaded=function(){var c;4===n.readyState&&(n.status<200||400<=n.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:n.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(c=n.getResponseHeader("Content-Range"))?-1:parseInt(c.substring(c.lastIndexOf("/")+1))),this.parseChunk(n.responseText)))},this._chunkError=function(l){this._sendError(new Error(n.statusText||l))}}function _e(r){var n,l;(r=r||{}).chunkSize||(r.chunkSize=v.LocalChunkSize),ie.call(this,r);var c=typeof FileReader<"u";this.stream=function(h){this._input=h,l=h.slice||h.webkitSlice||h.mozSlice,c?((n=new FileReader).onload=m(this._chunkLoaded,this),n.onerror=m(this._chunkError,this)):n=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var h=this._input;if(this._config.chunkSize){var y=Math.min(this._start+this._config.chunkSize,this._input.size);h=l.call(h,this._start,y)}var x=n.readAsText(h,this._config.encoding);c||this._chunkLoaded({target:{result:x}})},this._chunkLoaded=function(h){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(h.target.result)},this._chunkError=function(){this._sendError(n.error)}}function fe(r){var n;ie.call(this,r=r||{}),this.stream=function(l){return n=l,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var l,c=this._config.chunkSize;return c?(l=n.substring(0,c),n=n.substring(c)):(l=n,n=""),this._finished=!n,this.parseChunk(l)}}}function ve(r){ie.call(this,r=r||{});var n=[],l=!0,c=!1;this.pause=function(){ie.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){ie.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(h){this._input=h,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){c&&1===n.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),n.length?this.parseChunk(n.shift()):l=!0},this._streamData=m(function(h){try{n.push("string"==typeof h?h:h.toString(this._config.encoding)),l&&(l=!1,this._checkIsFinished(),this.parseChunk(n.shift()))}catch(y){this._streamError(y)}},this),this._streamError=m(function(h){this._streamCleanUp(),this._sendError(h)},this),this._streamEnd=m(function(){this._streamCleanUp(),c=!0,this._streamData("")},this),this._streamCleanUp=m(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function De(r){var n,l,c,h=Math.pow(2,53),y=-h,x=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,R=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,q=this,p=0,L=0,_=!1,ee=!1,Y=[],u={data:[],errors:[],meta:{}};if(A(r.step)){var F=r.step;r.step=function(g){if(u=g,O())k();else{if(k(),0===u.data.length)return;p+=g.data.length,r.preview&&p>r.preview?l.abort():(u.data=u.data[0],F(u,q))}}}function G(g){return"greedy"===r.skipEmptyLines?""===g.join("").trim():1===g.length&&0===g[0].length}function k(){return u&&c&&(J("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+v.DefaultDelimiter+"'"),c=!1),r.skipEmptyLines&&(u.data=u.data.filter(function(g){return!G(g)})),O()&&function(){if(u)if(Array.isArray(u.data[0])){for(var w=0;O()&&w<u.data.length;w++)u.data[w].forEach(g);u.data.splice(0,1)}else u.data.forEach(g);function g(E,M){A(r.transformHeader)&&(E=r.transformHeader(E,M)),Y.push(E)}}(),function(){if(!u||!r.header&&!r.dynamicTyping&&!r.transform)return u;function g(E,M){var C,Z=r.header?{}:[];for(C=0;C<E.length;C++){var U=C,b=E[C];r.header&&(U=C>=Y.length?"__parsed_extra":Y[C]),r.transform&&(b=r.transform(b,U)),b=Q(U,b),"__parsed_extra"===U?(Z[U]=Z[U]||[],Z[U].push(b)):Z[U]=b}return r.header&&(C>Y.length?J("FieldMismatch","TooManyFields","Too many fields: expected "+Y.length+" fields but parsed "+C,L+M):C<Y.length&&J("FieldMismatch","TooFewFields","Too few fields: expected "+Y.length+" fields but parsed "+C,L+M)),Z}var w=1;return!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(g),w=u.data.length):u.data=g(u.data,0),r.header&&u.meta&&(u.meta.fields=Y),L+=w,u}()}function O(){return r.header&&0===Y.length}function Q(g,w){return E=g,r.dynamicTypingFunction&&void 0===r.dynamicTyping[E]&&(r.dynamicTyping[E]=r.dynamicTypingFunction(E)),!0===(r.dynamicTyping[E]||r.dynamicTyping)?"true"===w||"TRUE"===w||"false"!==w&&"FALSE"!==w&&(function(M){if(x.test(M)){var C=parseFloat(M);if(y<C&&C<h)return!0}return!1}(w)?parseFloat(w):R.test(w)?new Date(w):""===w?null:w):w;var E}function J(g,w,E,M){var C={type:g,code:w,message:E};void 0!==M&&(C.row=M),u.errors.push(C)}this.parse=function(g,w,E){if(r.newline||(r.newline=function(U,b){U=U.substring(0,1048576);var re=new RegExp(me(b)+"([^]*?)"+me(b),"gm"),W=(U=U.replace(re,"")).split("\r"),z=U.split("\n");if(1===W.length||1<z.length&&z[0].length<W[0].length)return"\n";for(var te=0,V=0;V<W.length;V++)"\n"===W[V][0]&&te++;return te>=W.length/2?"\r\n":"\r"}(g,r.quoteChar||'"')),c=!1,r.delimiter)A(r.delimiter)&&(r.delimiter=r.delimiter(g),u.meta.delimiter=r.delimiter);else{var C=function(U,b,re,W,z){var ae,te,V,H;z=z||[",","\t","|",";",v.RECORD_SEP,v.UNIT_SEP];for(var oe=0;oe<z.length;oe++){var K=z[oe],ue=0,ne=0,Pe=0;V=void 0;for(var ge=new xe({comments:W,delimiter:K,newline:b,preview:10}).parse(U),Ce=0;Ce<ge.data.length;Ce++)if(re&&G(ge.data[Ce]))Pe++;else{var o=ge.data[Ce].length;ne+=o,void 0!==V?0<o&&(ue+=Math.abs(o-V),V=o):V=o}0<ge.data.length&&(ne/=ge.data.length-Pe),(void 0===te||ue<=te)&&(void 0===H||H<ne)&&1.99<ne&&(te=ue,ae=K,H=ne)}return{successful:!!(r.delimiter=ae),bestDelimiter:ae}}(g,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess);C.successful?r.delimiter=C.bestDelimiter:(c=!0,r.delimiter=v.DefaultDelimiter),u.meta.delimiter=r.delimiter}var Z=ye(r);return r.preview&&r.header&&Z.preview++,n=g,l=new xe(Z),u=l.parse(n,w,E),k(),_?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return _},this.pause=function(){_=!0,l.abort(),n=A(r.chunk)?"":n.substring(l.getCharIndex())},this.resume=function(){q.streamer._halted?(_=!1,q.streamer.parseChunk(n,!0)):setTimeout(q.resume,3)},this.aborted=function(){return ee},this.abort=function(){ee=!0,l.abort(),u.meta.aborted=!0,A(r.complete)&&r.complete(u),n=""}}function me(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function xe(r){var n,l=(r=r||{}).delimiter,c=r.newline,h=r.comments,y=r.step,x=r.preview,R=r.fastMode,q=n=r.quoteChar??'"';if(void 0!==r.escapeChar&&(q=r.escapeChar),("string"!=typeof l||-1<v.BAD_DELIMITERS.indexOf(l))&&(l=","),h===l)throw new Error("Comment character same as delimiter");!0===h?h="#":("string"!=typeof h||-1<v.BAD_DELIMITERS.indexOf(h))&&(h=!1),"\n"!==c&&"\r"!==c&&"\r\n"!==c&&(c="\n");var p=0,L=!1;this.parse=function(_,ee,Y){if("string"!=typeof _)throw new Error("Input must be a string");var u=_.length,F=l.length,G=c.length,k=h.length,O=A(y),Q=[],J=[],g=[],w=p=0;if(!_)return H();if(R||!1!==R&&-1===_.indexOf(n)){for(var E=_.split(c),M=0;M<E.length;M++){if(p+=(g=E[M]).length,M!==E.length-1)p+=c.length;else if(Y)return H();if(!h||g.substring(0,k)!==h){if(O){if(Q=[],z(g.split(l)),oe(),L)return H()}else z(g.split(l));if(x&&x<=M)return Q=Q.slice(0,x),H(!0)}}return H()}for(var C=_.indexOf(l,p),Z=_.indexOf(c,p),U=new RegExp(me(q)+me(n),"g"),b=_.indexOf(n,p);;)if(_[p]!==n)if(h&&0===g.length&&_.substring(p,p+k)===h){if(-1===Z)return H();Z=_.indexOf(c,p=Z+G),C=_.indexOf(l,p)}else if(-1!==C&&(C<Z||-1===Z))g.push(_.substring(p,C)),C=_.indexOf(l,p=C+F);else{if(-1===Z)break;if(g.push(_.substring(p,Z)),V(Z+G),O&&(oe(),L))return H();if(x&&Q.length>=x)return H(!0)}else for(b=p,p++;;){if(-1===(b=_.indexOf(n,b+1)))return Y||J.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Q.length,index:p}),te();if(b===u-1)return te(_.substring(p,b).replace(U,n));if(n!==q||_[b+1]!==q){if(n===q||0===b||_[b-1]!==q){-1!==C&&C<b+1&&(C=_.indexOf(l,b+1)),-1!==Z&&Z<b+1&&(Z=_.indexOf(c,b+1));var re=ae(-1===Z?C:Math.min(C,Z));if(_.substr(b+1+re,F)===l){g.push(_.substring(p,b).replace(U,n)),_[p=b+1+re+F]!==n&&(b=_.indexOf(n,p)),C=_.indexOf(l,p),Z=_.indexOf(c,p);break}var W=ae(Z);if(_.substring(b+1+W,b+1+W+G)===c){if(g.push(_.substring(p,b).replace(U,n)),V(b+1+W+G),C=_.indexOf(l,p),b=_.indexOf(n,p),O&&(oe(),L))return H();if(x&&Q.length>=x)return H(!0);break}J.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Q.length,index:p}),b++}}else b++}return te();function z(K){Q.push(K),w=p}function ae(K){var ue=0;if(-1!==K){var ne=_.substring(b+1,K);ne&&""===ne.trim()&&(ue=ne.length)}return ue}function te(K){return Y||(void 0===K&&(K=_.substring(p)),g.push(K),p=u,z(g),O&&oe()),H()}function V(K){p=K,z(g),g=[],Z=_.indexOf(c,p)}function H(K){return{data:Q,errors:J,meta:{delimiter:l,linebreak:c,aborted:L,truncated:!!K,cursor:w+(ee||0)}}}function oe(){y(H()),Q=[],J=[]}},this.abort=function(){L=!0},this.getCharIndex=function(){return p}}function Ee(r){var n=r.data,l=e[n.workerId],c=!1;if(n.error)l.userError(n.error,n.file);else if(n.results&&n.results.data){var h={abort:function(){c=!0,Ae(n.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:be,resume:be};if(A(l.userStep)){for(var y=0;y<n.results.data.length&&(l.userStep({data:n.results.data[y],errors:n.results.errors,meta:n.results.meta},h),!c);y++);delete n.results}else A(l.userChunk)&&(l.userChunk(n.results,h,n.file),delete n.results)}n.finished&&!c&&Ae(n.workerId,n.results)}function Ae(r,n){var l=e[r];A(l.userComplete)&&l.userComplete(n),l.terminate(),delete e[r]}function be(){throw new Error("Not implemented.")}function ye(r){if("object"!=typeof r||null===r)return r;var n=Array.isArray(r)?[]:{};for(var l in r)n[l]=ye(r[l]);return n}function m(r,n){return function(){r.apply(n,arguments)}}function A(r){return"function"==typeof r}return Se&&(D.onmessage=function(r){var n=r.data;if(void 0===v.WORKER_ID&&n&&(v.WORKER_ID=n.workerId),"string"==typeof n.input)D.postMessage({workerId:v.WORKER_ID,results:v.parse(n.input,n.config),finished:!0});else if(D.File&&n.input instanceof File||n.input instanceof Object){var l=v.parse(n.input,n.config);l&&D.postMessage({workerId:v.WORKER_ID,results:l,finished:!0})}}),(ce.prototype=Object.create(ie.prototype)).constructor=ce,(_e.prototype=Object.create(ie.prototype)).constructor=_e,(fe.prototype=Object.create(fe.prototype)).constructor=fe,(ve.prototype=Object.create(ie.prototype)).constructor=ve,v},void 0!==(X=S.apply(Ze,[]))&&(qe.exports=X)}}]);