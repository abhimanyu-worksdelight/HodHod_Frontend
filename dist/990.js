"use strict";(self.webpackChunkng2angle=self.webpackChunkng2angle||[]).push([[990],{990:(W,U,i)=>{i.r(U),i.d(U,{UserRolesModule:()=>K});var f=i(6895),g=i(6691),p=i(1071),_=i(2734),F=i(5229),C=i(537),d=i(4719),c=i(5867),e=(i(2504),i(4650)),Z=i(4606),w=i(8064),R=i(5328),q=i(362),x=i(398),b=i(551);function I(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"This field is required"),e.qZA())}function D(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"This field is required"),e.qZA())}function N(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"This field is required"),e.qZA())}function J(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"Please enter a valid email"),e.qZA())}function S(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"This field is required"),e.qZA())}function Y(s,r){if(1&s&&(e.TgZ(0,"span",34),e._uU(1),e.qZA()),2&s){const n=e.oxw();e.xp6(1),e.hij(" ",null==n.selectedFile?null:n.selectedFile.name," ")}}function M(s,r){if(1&s&&(e.TgZ(0,"span",34),e._uU(1),e.qZA()),2&s){const n=e.oxw();e.xp6(1),e.hij(" ",n.fileName," ")}}function Q(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"This field is required"),e.qZA())}function E(s,r){1&s&&e._UZ(0,"span",35)}function L(s,r){1&s&&(e.TgZ(0,"div",33),e._uU(1,"store is required"),e.qZA())}let k=(()=>{class s{constructor(n,t,o,l,a,m,u){this.userService=t,this.afs=o,this.authService=l,this.router=a,this.validationService=m,this.fireStorage=u,this.onToggleCheckValue=!1,this.loading=!1,this.saveLoading=!1,this.positionItems=["Business Manager","Sales"],this.disabled=!1,this.value={},this.emailPattern=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,this.valForm=n.group({name:[null,d.kI.required],email:[null,d.kI.required],password:[null,d.kI.required],phone:[null,d.kI.required],isAdmin:[!1,d.kI.required],file:"",roleType:[null,d.kI.required]})}ngOnInit(){this.uid=sessionStorage.getItem("uid"),this.userType=sessionStorage.getItem("customer")}onFileChanged(n){if(n){if(this.selectedFile=n.target.files[0],this.fileUrl=this.selectedFile.src,0===this.selectedFile.length)return;const t=new FileReader;t.readAsDataURL(this.selectedFile),t.onload=o=>{this.fileUrl=t.result}}}addUserData(n,t){n.preventDefault();for(let o in this.valForm.controls)this.valForm.controls[o].markAsTouched();if(this.valForm.valid&&this.selectedFile){const o=this.selectedFile,l=Date.now(),a="/users",u=this.fireStorage.ref(`${a}/${l}-${o.name}`);this.fireStorage.upload(`${a}/${l}-${o.name}`,o).snapshotChanges().pipe((0,C.x)(()=>{u.getDownloadURL().subscribe(v=>{v&&(this.fileUrl=v,this.saveUserToDB(t,v))})})).subscribe(y=>{})}else this.valForm.valid?this.saveUserToDB(t,""):console.log("this.valForm",this.valForm)}registerUser(n){console.log("data",n);const{email:t,password:o}=n;return new Promise((l,a)=>{c.Z.auth().createUserWithEmailAndPassword(t,o).then(m=>(this.user_id=m.user.uid,l(m))).catch(m=>a(m))})}saveUserToDB(n,t){this.saveLoading=!0,this.registerUser(n).then(()=>{let o={image:t,name:n.name,email:n.email,phone_number:n.phone,is_admin:n.isAdmin,created_at:c.Z.firestore.FieldValue.serverTimestamp(),updated_at:c.Z.firestore.FieldValue.serverTimestamp(),uid:this.uid,type:this.userType,deleted_at:null,deleted_by:null,disabled:!1,deleted_by_user_type:null};console.log("data",o),this.userService.addUser(o).then(()=>{this.validationService.sweetalertSuccess(),this.router.navigate(["users/user-listing"])}).catch(l=>{console.log(l)})})}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(d.QS),e.Y36(Z.K),e.Y36(w.ST),e.Y36(R.e),e.Y36(g.F0),e.Y36(q.R),e.Y36(x.Q1))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user-roles-add"]],decls:68,vars:17,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-arrow-left","mr-1"],[1,"row"],[1,"col-md-12"],[1,"card","card-default"],[1,"card-body"],["role","form",1,"form-validate",3,"formGroup","ngSubmit","keydown.enter","keydown.shift.enter"],["dataPost","ngForm"],[1,"form-row"],[1,"col-lg-6","mb-3"],["ngModel","","required","","formControlName","name","name","name","type","text","placeholder","Enter user name",1,"form-control"],["class","text-danger",4,"ngIf"],[1,"col-lg-6"],["ngModel","","required","","formControlName","phone","name","phone","type","text","placeholder","Enter phone",1,"form-control"],["ngModel","","required","","formControlName","email","name","email","type","email","placeholder","Enter email",1,"form-control",3,"pattern"],[1,"col-lg-9"],["ngModel","","required","","formControlName","password","name","password","type","password","placeholder","Enter password",1,"form-control"],[1,"col-lg-3"],["ngModel","","formControlName","isAdmin"],[1,"form-group"],["for","image-input",1,"file-upload"],[1,"btn","btn-secondary"],[1,"far","fa-folder-open","mr"],["ngModel","","formControlName","file","type","file","name","file","accept",".jpeg,.jpg,.png,.svg",1,"form-control",3,"input"],["class","form-control",4,"ngIf"],[1,"image-preview-box"],["onerror","this.onerror=null;this.src='assets/img/preview-img.png';",1,"previewImage",3,"src"],["class","spinner-border spinner-border-sm custom-spinner",4,"ngIf"],["required","","formControlName","roleType","name","roleType","optionValueField","id","optionTextField","text","placeholder","Select position",1,"custom-single-select",3,"multiple","items","disabled"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],["type","submit",1,"btn","btn-sm","btn-info"],[1,"text-danger"],[1,"form-control"],[1,"spinner-border","spinner-border-sm","custom-spinner"]],template:function(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Add user Role"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Back "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"form",8,9),e.NdJ("ngSubmit",function(a){e.CHM(o);const m=e.MAs(12);return e.KtG(t.addUserData(a,m.value))})("keydown.enter",function(a){return a.preventDefault()})("keydown.shift.enter",function(a){return a.preventDefault()}),e.TgZ(13,"div",10)(14,"div",11)(15,"label"),e._uU(16,"User name"),e.qZA(),e._UZ(17,"input",12),e.YNc(18,I,2,0,"div",13),e.qZA(),e.TgZ(19,"div",14)(20,"label"),e._uU(21,"Phone"),e.qZA(),e._UZ(22,"input",15),e.YNc(23,D,2,0,"div",13),e.qZA()(),e.TgZ(24,"div",10)(25,"div",11)(26,"label"),e._uU(27,"Email"),e.qZA(),e._UZ(28,"input",16),e.YNc(29,N,2,0,"div",13),e.YNc(30,J,2,0,"div",13),e.qZA(),e.TgZ(31,"div",11)(32,"div",4)(33,"div",17)(34,"label"),e._uU(35,"Password"),e.qZA(),e._UZ(36,"input",18),e.YNc(37,S,2,0,"div",13),e.qZA(),e.TgZ(38,"div",19)(39,"label"),e._uU(40,"Is Admin?"),e.qZA(),e._UZ(41,"ui-switch",20),e.qZA()()()(),e.TgZ(42,"div",10)(43,"div",11)(44,"div",21)(45,"label"),e._uU(46,"image"),e.qZA(),e.TgZ(47,"label",22)(48,"button",23),e._uU(49," Select file "),e._UZ(50,"em",24),e.qZA(),e.TgZ(51,"input",25),e.NdJ("input",function(a){return t.onFileChanged(a)}),e.qZA(),e.YNc(52,Y,2,1,"span",26),e.YNc(53,M,2,1,"span",26),e.qZA(),e.YNc(54,Q,2,0,"div",13),e.qZA(),e.TgZ(55,"div",27),e._UZ(56,"img",28),e.YNc(57,E,1,0,"span",29),e.qZA()(),e.TgZ(58,"div",14)(59,"div",21)(60,"label"),e._uU(61,"Role Type"),e.qZA(),e._UZ(62,"ngx-select",30),e.YNc(63,L,2,0,"div",13),e.qZA()()(),e.TgZ(64,"button",31),e.NdJ("click",function(){e.CHM(o);const a=e.MAs(12);return e.KtG(a.resetForm({}))}),e._uU(65,"Clear"),e.qZA(),e.TgZ(66,"button",32),e._uU(67,"Save"),e.qZA()()()()()()}2&n&&(e.xp6(4),e.Q6J("routerLink","/users/user-listing"),e.xp6(7),e.Q6J("formGroup",t.valForm),e.xp6(7),e.Q6J("ngIf",t.valForm.controls.name.hasError("required")&&(t.valForm.controls.name.dirty||t.valForm.controls.name.touched)),e.xp6(5),e.Q6J("ngIf",t.valForm.controls.phone.hasError("required")&&(t.valForm.controls.phone.dirty||t.valForm.controls.phone.touched)),e.xp6(5),e.Q6J("pattern",t.emailPattern),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.email.hasError("required")&&(t.valForm.controls.email.dirty||t.valForm.controls.email.touched)),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.email.hasError("pattern")&&(t.valForm.controls.email.dirty||t.valForm.controls.email.touched)),e.xp6(7),e.Q6J("ngIf",t.valForm.controls.password.hasError("required")&&(t.valForm.controls.password.dirty||t.valForm.controls.password.touched)),e.xp6(15),e.Q6J("ngIf",null==t.selectedFile?null:t.selectedFile.name),e.xp6(1),e.Q6J("ngIf",!(null!=t.selectedFile&&t.selectedFile.name)),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.file.hasError("required")&&(t.valForm.controls.file.dirty||t.valForm.controls.file.touched)),e.xp6(2),e.Q6J("src",t.fileUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(5),e.Q6J("multiple",!1)("items",t.positionItems)("disabled",t.disabled),e.xp6(1),e.Q6J("ngIf",t.valForm.controls.roleType.hasError("required")&&(t.valForm.controls.roleType.dirty||t.valForm.controls.roleType.touched)))},dependencies:[f.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.c5,d.sg,d.u,g.rH,_.ob,b.O2]}),s})(),H=(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user-roles-edit"]],decls:2,vars:0,template:function(n,t){1&n&&(e.TgZ(0,"p"),e._uU(1,"user-roles-edit works!"),e.qZA())}}),s})();function P(s,r){1&s&&e._UZ(0,"div",19)}function j(s,r){if(1&s){const n=e.EpF();e.TgZ(0,"div",20)(1,"button",21),e._UZ(2,"em",22),e.qZA(),e.TgZ(3,"button",23),e.NdJ("click",function(){const o=e.CHM(n),l=o.value,a=o.row,m=e.oxw();return e.KtG(m.deleteUserData(l,a))}),e._UZ(4,"em",24),e.qZA()()}if(2&s){const n=r.value;e.xp6(1),e.MGl("routerLink","/users/edit-user/",n,"")}}function O(s,r){if(1&s&&e._UZ(0,"img",27),2&s){const n=e.oxw().value;e.s9C("src",n,e.LSH)}}function $(s,r){1&s&&e._UZ(0,"img",28)}function B(s,r){if(1&s&&(e.YNc(0,O,1,1,"img",25),e.YNc(1,$,1,0,"img",26)),2&s){const n=r.value;e.Q6J("ngIf",n),e.xp6(1),e.Q6J("ngIf",!n)}}function G(s,r){if(1&s&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&s){const n=r.value;e.xp6(1),e.Oqu(n||"N/A")}}function X(s,r){if(1&s&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&s){const n=r.value;e.xp6(1),e.Oqu(n||"N/A")}}function V(s,r){if(1&s&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&s){const n=r.value;e.xp6(1),e.Oqu(n)}}i(6776);const h=i(1373);let T=(()=>{class s{constructor(n){this.userService=n,this.Users=[],this.EndUsers=[],this.rowsFilter=[],this.arrayTableData=[],this.arrayRowData="",this.isLoading=!1}ngOnInit(){this.uid=sessionStorage.getItem("uid"),this.loginType=sessionStorage.getItem("loginType"),this.getUserListingData()}getUserListingData(){this.userService.getUserList().subscribe(n=>{if(this.isLoading=!0,this.Users=[],this.EndUsers=[],this.rowsFilter=[],this.arrayTableData=[],n.length){this.Users=n.map(t=>{let o=t.payload.doc.data();return o.phone_number=o.phone_number&&o.country_code?`(${o.country_code}) ${o.phone_number}`:"--",{id:t.payload.doc.id,data:o}}),this.arrayTableData=[];for(let t=0;t<this.Users.length;t++)"uMdXXnNmXBIk3HiJX9qs"==this.Users[t].data.type&&(this.arrayRowData=this.Users[t].data,this.arrayRowData.sr_no=t+1,this.arrayRowData.id=this.Users[t].id,this.arrayTableData.push(this.arrayRowData),this.isLoading=!1);this.rowsFilter=this.arrayTableData}else this.isLoading=!1})}updateFilter(n){const t=n.target.value.toLowerCase(),o=this.arrayTableData.filter(function(l){if(""!=l.name&&null!=l.name)return-1!==l.name.toLowerCase().indexOf(t)||!t});this.rowsFilter=o,this.table.offset=0}ngAfterViewInit(){}deleteUserData(n,t){const o={deleted_at:c.Z.firestore.FieldValue.serverTimestamp(),deleted_by:this.uid,disabled:!1,deleted_by_user_type:this.loginType};this.sweetalertWarning(t.uid,n,o,"singleUserData")}sweetalertWarning(n,t,o,l){h({title:"Are you sure?",text:"Want to delete data!",icon:"warning",buttons:{cancel:{text:"Cancel",value:null,visible:!0,className:"",closeModal:!0},confirm:{text:"Yes, delete it!",value:!0,visible:!0,className:"bg-danger",closeModal:!1}}}).then(a=>{if(a)if("singleUserData"==l)c.Z.functions().httpsCallable("disableUser")(n).then(u=>{u&&this.userService.softDeleteSingleUser(t,o).then(()=>{h("Deleted!","Data deleted!","success"),this.getUserListingData()})});else if("multipleUserData"==l){const m=c.Z.functions().httpsCallable("disableMultipleUser");o.forEach(u=>{m(u.uid).then(A=>{A&&this.userService.softDeleteMultipleUser(u).then(()=>{h("Deleted!","Data deleted!","success"),this.getUserListingData()})})})}})}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(Z.K))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user-roles"]],viewQuery:function(n,t){if(1&n&&e.Gf(p.nE,7),2&n){let o;e.iGM(o=e.CRH())&&(t.table=o.first)}},decls:26,vars:9,consts:[[1,"content-heading"],[1,"d-flex","justify-content-between","w-100","align-items-center"],["type","button",1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],["_ngcontent-lgi-c20","",1,"icon-plus","mr-1"],[1,"card","card-default","b"],["class","spinner-border loading","role","status",4,"ngIf"],[1,"card-body"],[1,"row","mb-4"],[1,"col-lg-4"],["type","text","placeholder","Type to filter the name column...",1,"form-control",3,"keyup"],[1,"bootstrap","no-detail-row",3,"scrollbarH","columnMode","footerHeight","rowHeight","limit","rows"],["table",""],["name","Actions","sortable","false","prop","id"],["ngx-datatable-cell-template",""],["name","Unique Id","prop","id",3,"width"],["name","Image","sortable","false","prop","userImage"],["name","Name","prop","name"],["name","Email","prop","email"],["name","Phone","prop","phone_number"],["role","status",1,"spinner-border","loading"],[1,"d-flex","align-items-center"],["type","button",1,"mr-1","btn","btn-success","comn-action-btn","mb-1",3,"routerLink"],["_ngcontent-lgi-c20","",1,"fas","fa-edit"],["type","button",1,"mr-1","btn","btn-danger","comn-action-btn","mb-1",3,"click"],["_ngcontent-lgi-c20","",1,"fas","fa-trash-alt"],["class","listImage",3,"src",4,"ngIf"],["src","assets/img/profile.jpg","class","listImage",4,"ngIf"],[1,"listImage",3,"src"],["src","assets/img/profile.jpg",1,"listImage"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span"),e._uU(3,"Users Roles"),e.qZA(),e.TgZ(4,"button",2),e._UZ(5,"em",3),e._uU(6," Add New "),e.qZA()()(),e.TgZ(7,"div",4),e.YNc(8,P,1,0,"div",5),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"input",9),e.NdJ("keyup",function(l){return t.updateFilter(l)}),e.qZA()()(),e.TgZ(13,"ngx-datatable",10,11)(15,"ngx-datatable-column",12),e.YNc(16,j,5,1,"ng-template",13),e.qZA(),e._UZ(17,"ngx-datatable-column",14),e.TgZ(18,"ngx-datatable-column",15),e.YNc(19,B,2,2,"ng-template",13),e.qZA(),e.TgZ(20,"ngx-datatable-column",16),e.YNc(21,G,2,1,"ng-template",13),e.qZA(),e.TgZ(22,"ngx-datatable-column",17),e.YNc(23,X,2,1,"ng-template",13),e.qZA(),e.TgZ(24,"ngx-datatable-column",18),e.YNc(25,V,2,1,"ng-template",13),e.qZA()()()()),2&n&&(e.xp6(4),e.Q6J("routerLink","/roles/add-roles"),e.xp6(4),e.Q6J("ngIf",t.isLoading),e.xp6(5),e.Q6J("scrollbarH",!0)("columnMode","force")("footerHeight",50)("rowHeight","auto")("limit",10)("rows",t.rowsFilter),e.xp6(4),e.Q6J("width",180))},dependencies:[f.O5,g.rH,p.nE,p.UC,p.vq],encapsulation:2}),s})();const z=[{path:"",component:T},{path:"roles",component:T},{path:"add-roles",component:k},{path:"edit-role/:id",component:H}];let K=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[f.ez,F.m,p.xD,_.Su,b.i4,g.Bz.forChild(z)]}),s})()}}]);